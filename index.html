<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Alex English Academy</title>
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2b4c7e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <!-- CSS Universal -->
    <link rel="stylesheet" href="src/styles/base.css">
    <link rel="stylesheet" href="src/styles/layout.css">
    <link rel="stylesheet" href="src/styles/theme-patriot.css">
</head>
<body>
    <!-- User Widget -->
    <div class="user-widget">
        <div class="user-avatar" id="userAvatar">A</div>
        <span class="user-name" id="userName">Aluno</span>
        <button class="logout-btn" onclick="logout()">Sair</button>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1 class="logo">Teacher Alex <span class="logo-highlight">English Academy</span></h1>
            <p class="main-subtitle" id="welcomeMsg">Bem-vindo de volta!</p>
        </header>
        
        <!-- Stats Dashboard -->
        <section class="stats-dashboard">
            <div class="stat-card">
                <div class="stat-icon">üìö</div>
                <div class="stat-info">
                    <div class="stat-number" id="statLessons">0</div>
                    <div class="stat-label">Li√ß√µes Completas</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">üìñ</div>
                <div class="stat-info">
                    <div class="stat-number" id="statChapters">0</div>
                    <div class="stat-label">Cap√≠tulos Lidos</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">üèÜ</div>
                <div class="stat-info">
                    <div class="stat-number" id="statBadges">0</div>
                    <div class="stat-label">Badges Earned</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">‚è±Ô∏è</div>
                <div class="stat-info">
                    <div class="stat-number" id="statTime">0h</div>
                    <div class="stat-label">Tempo de Estudo</div>
                </div>
            </div>
        </section>
        
        <!-- Main Activities -->
        <main class="hubs-grid">
            <!-- Listening Hub -->
            <div class="hub-card" onclick="navigate('listening')">
                <div class="hub-header">
                    <div class="hub-icon">üéß</div>
                    <h3 class="hub-title-card">Listening Practice</h3>
                    <p class="hub-description">Melhore sua compreens√£o auditiva com di√°logos aut√™nticos</p>
                </div>
                <div class="hub-content">
                    <ul class="hub-features">
                        <li>23 li√ß√µes interativas dispon√≠veis</li>
                        <li>√Åudios nativos de alta qualidade</li>
                        <li>Quiz de compreens√£o din√¢mico</li>
                        <li>Sistema de badges motivador</li>
                        <li>N√≠veis: Foundation ‚Üí Advanced</li>
                    </ul>
                </div>
                <div class="hub-footer">
                    <button class="hub-button">üéß Come√ßar Listening</button>
                </div>
                <div class="progress-badge" id="listeningProgress">‚ú® Pronto</div>
            </div>
            
            <!-- Graded Readers Hub -->
            <div class="hub-card" onclick="navigate('graded-readers')">
                <div class="hub-header">
                    <div class="hub-icon">üìö</div>
                    <h3 class="hub-title-card">Graded Readers</h3>
                    <p class="hub-description">Hist√≥rias organizadas por n√≠vel para absor√ß√£o natural de vocabul√°rio</p>
                </div>
                <div class="hub-content">
                    <ul class="hub-features">
                        <li>N√≠vel A1: The Roommate Problem</li>
                        <li>N√≠vel A2: The Secret House</li>
                        <li>N√≠vel B1: Em desenvolvimento</li>
                        <li>√Åudios IA de alta qualidade</li>
                        <li>Progress√£o did√°tica estruturada</li>
                    </ul>
                </div>
                <div class="hub-footer">
                    <button class="hub-button">üìö Explorar Hist√≥rias</button>
                </div>
                <div class="progress-badge" id="gradedProgress">‚ú® Pronto</div>
            </div>
            
            <!-- Pure Reading Hub -->
            <div class="hub-card" onclick="navigate('pure-reading')">
                <div class="hub-header">
                    <div class="hub-icon">üìñ</div>
                    <h3 class="hub-title-card">Pure Reading</h3>
                    <p class="hub-description">Foco 100% na interpreta√ß√£o textual sem distra√ß√µes</p>
                </div>
                <div class="hub-content">
                    <ul class="hub-features">
                        <li>A2 Low: Perfect Neighbor Story</li>
                        <li>A2 Mid: Hist√≥rias intermedi√°rias</li>
                        <li>B1: Para alunos avan√ßados</li>
                        <li>Leitura pura sem depend√™ncia de √°udio</li>
                        <li>Typography otimizada para leitura</li>
                    </ul>
                </div>
                <div class="hub-footer">
                    <button class="hub-button">üìñ Come√ßar Leitura</button>
                </div>
                <div class="progress-badge" id="pureProgress">‚ú® Pronto</div>
            </div>
            
            <!-- Secret Area -->
            <div class="hub-card coming-soon" onclick="showComingSoon()">
                <div class="hub-header">
                    <div class="hub-icon">üîí</div>
                    <h3 class="hub-title-card">Secret Area</h3>
                    <p class="hub-description">√Årea exclusiva para alunos dedicados e conquistadores</p>
                </div>
                <div class="hub-content">
                    <ul class="hub-features">
                        <li>Conte√∫do premium exclusivo</li>
                        <li>Desafios especiais avan√ßados</li>
                        <li>Certificados de conquista</li>
                        <li>Acesso via badges earned</li>
                        <li>Surpresas para dedicados</li>
                    </ul>
                </div>
                <div class="hub-footer">
                    <button class="hub-button" disabled>üöÄ Em Breve</button>
                </div>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="footer">
            <h3>üéì Teacher Alex English Academy</h3>
            <p>Sua jornada personalizada para dominar o ingl√™s americano!</p>
            <p>Contato direto: <a href="mailto:alexmg@gmail.com" class="contact-link">alexmg@gmail.com</a></p>
        </footer>
    </div>

    <script>
        // ===== AUTH CHECK =====
        if (sessionStorage.getItem('studentLoggedIn') !== 'true') {
            window.location.href = 'pages/auth/login.html';
        }

        // ===== INITIALIZATION =====
        const studentName = sessionStorage.getItem('studentUsername') || 'Student';
        
        // Update UI with student info
        document.getElementById('userName').textContent = studentName;
        document.getElementById('userAvatar').textContent = studentName.charAt(0).toUpperCase();
        document.getElementById('welcomeMsg').textContent = `Bem-vindo de volta, ${studentName}!`;

        // ===== STATS DASHBOARD =====
        function loadStats() {
            const progressKey = `progress_${studentName}`;
            const saved = localStorage.getItem(progressKey);
            
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    
                    // Calculate lessons completed
                    const listeningLessons = data.listening?.lessonsCompleted?.length || 0;
                    const totalLessons = listeningLessons;
                    
                    // Calculate chapters completed
                    const readingChapters = data.reading?.chaptersCompleted?.length || 0;
                    const roommateChapters = data.roommate?.chaptersCompleted?.length || 0;
                    const neighborChapters = data.neighbor?.chaptersCompleted?.length || 0;
                    const totalChapters = readingChapters + roommateChapters + neighborChapters;
                    
                    // Calculate badges earned
                    const listeningBadges = data.listening?.badges?.length || 0;
                    const readingBadges = data.reading?.badges?.length || 0;
                    const roommateBadges = data.roommate?.badges?.length || 0;
                    const neighborBadges = data.neighbor?.badges?.length || 0;
                    const totalBadges = listeningBadges + readingBadges + roommateBadges + neighborBadges;
                    
                    // Calculate study time (convert from milliseconds to hours)
                    const totalStudyTime = data.totalStudyTime || 0;
                    const studyHours = Math.floor(totalStudyTime / (1000 * 60 * 60));
                    
                    // Update UI
                    document.getElementById('statLessons').textContent = totalLessons;
                    document.getElementById('statChapters').textContent = totalChapters;
                    document.getElementById('statBadges').textContent = totalBadges;
                    document.getElementById('statTime').textContent = studyHours + 'h';
                    
                    // Update progress badges based on completion
                    updateProgressBadges(data);
                    
                } catch (e) {
                    console.error('Erro ao carregar estat√≠sticas:', e);
                    // Set default values if there's an error
                    setDefaultStats();
                }
            } else {
                // Set default values for new users
                setDefaultStats();
            }
        }

        function setDefaultStats() {
            document.getElementById('statLessons').textContent = '0';
            document.getElementById('statChapters').textContent = '0';
            document.getElementById('statBadges').textContent = '0';
            document.getElementById('statTime').textContent = '0h';
        }

        function updateProgressBadges(data) {
            // Listening progress
            const listeningCompleted = data.listening?.lessonsCompleted?.length || 0;
            const listeningBadge = document.getElementById('listeningProgress');
            if (listeningCompleted > 0) {
                listeningBadge.textContent = `${listeningCompleted} ‚úì`;
                listeningBadge.style.background = 'var(--success)';
            }
            
            // Graded readers progress
            const roommateCompleted = data.roommate?.chaptersCompleted?.length || 0;
            const readingCompleted = data.reading?.chaptersCompleted?.length || 0;
            const gradedBadge = document.getElementById('gradedProgress');
            const totalGradedChapters = roommateCompleted + readingCompleted;
            if (totalGradedChapters > 0) {
                gradedBadge.textContent = `${totalGradedChapters} ‚úì`;
                gradedBadge.style.background = 'var(--success)';
            }
            
            // Pure reading progress
            const neighborCompleted = data.neighbor?.chaptersCompleted?.length || 0;
            const pureBadge = document.getElementById('pureProgress');
            if (neighborCompleted > 0) {
                pureBadge.textContent = `${neighborCompleted} ‚úì`;
                pureBadge.style.background = 'var(--success)';
            }
        }

        // ===== NAVIGATION SYSTEM =====
        function navigate(section) {
            const card = event.currentTarget;
            const button = card.querySelector('.hub-button');
            const originalText = button.textContent;
            
            // Loading state
            button.textContent = 'Carregando...';
            card.style.opacity = '0.7';
            
            const routes = {
                'listening': 'pages/hubs/listening-hub.html',
                'graded-readers': 'pages/hubs/graded-readers-hub.html',
                'pure-reading': 'pages/hubs/pure-reading-hub.html'
            };
            
            setTimeout(() => {
                if (routes[section]) {
                    window.location.href = routes[section];
                } else {
                    // Restore button if route doesn't exist
                    button.textContent = originalText;
                    card.style.opacity = '1';
                    alert('üöÄ Se√ß√£o em desenvolvimento!');
                }
            }, 500);
        }

        function showComingSoon() {
            const messages = [
                'üîí A Secret Area est√° sendo preparada especialmente para voc√™s!',
                'üèÜ Continue ganhando badges para desbloquear conte√∫do exclusivo!',
                '‚≠ê Algo incr√≠vel est√° vindo para os alunos mais dedicados!',
                'üéØ Mantenha o foco nos estudos - surpresas est√£o chegando!'
            ];
            alert(messages[Math.floor(Math.random() * messages.length)]);
        }

        // ===== LOGOUT FUNCTION =====
        function logout() {
            if (confirm('Tem certeza que deseja sair?')) {
                sessionStorage.clear();
                window.location.href = 'pages/auth/login.html';
            }
        }

        // ===== PWA SERVICE WORKER =====
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then(registration => {
                    console.log('üîß Service Worker registrado com sucesso:', registration);
                })
                .catch(error => {
                    console.log('‚ùå Falha ao registrar Service Worker:', error);
                });
        }

        // ===== STUDY TIME TRACKING =====
        let sessionStartTime = Date.now();
        
        // Track study time when user leaves
        window.addEventListener('beforeunload', () => {
            const sessionTime = Date.now() - sessionStartTime;
            const progressKey = `progress_${studentName}`;
            const saved = localStorage.getItem(progressKey);
            
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    data.totalStudyTime = (data.totalStudyTime || 0) + sessionTime;
                    localStorage.setItem(progressKey, JSON.stringify(data));
                } catch (e) {
                    console.error('Erro ao salvar tempo de estudo:', e);
                }
            }
        });

        // ===== INITIALIZATION =====
        loadStats();
        
        console.log('üéì TEACHER ALEX ENGLISH ACADEMY carregado!');
        console.log('üë§ Usu√°rio logado:', studentName);
        console.log('üìä Dashboard inicializado com sucesso!');
    </script>
</body>
</html>
