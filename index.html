<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Alex English Academy</title>
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2b4c7e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <!-- CSS Universal -->
    <link rel="stylesheet" href="src/styles/base.css">
    <link rel="stylesheet" href="src/styles/layout.css">
    <link rel="stylesheet" href="src/styles/theme-patriot.css">

    <!-- ‚úÖ CORRE√á√ÉO #1: Path correto para navigation-fix -->
    <script src="src/scripts/core/navigation-fix.js"></script>
    
</head>
<body>
    <!-- User Widget -->
    <div class="user-widget">
        <div class="user-avatar" id="userAvatar">A</div>
        <span class="user-name" id="userName">Aluno</span>
        <button class="logout-btn" onclick="logout()">Sair</button>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1 class="logo">Teacher Alex <span class="logo-highlight">English Academy</span></h1>
            <p class="main-subtitle" id="welcomeMsg">Bem-vindo de volta!</p>
        </header>
        
        <!-- Stats Section Title -->
        <section class="stats-section">
            <h2 class="stats-title">üìä Seu Progresso Acad√™mico</h2>
            <p class="stats-subtitle">Acompanhe sua jornada de aprendizado em tempo real</p>
        </section>
        
        <!-- Stats Dashboard -->
        <section class="stats-dashboard">
            <div class="stat-card lessons">
                <div class="stat-icon">üìö</div>
                <div class="stat-info">
                    <div class="stat-number" id="statLessons">0</div>
                    <div class="stat-label">Li√ß√µes Completas</div>
                </div>
                <div class="stat-trend" id="lessonsTrend">üìà +1</div>
            </div>
            
            <div class="stat-card chapters">
                <div class="stat-icon">üìñ</div>
                <div class="stat-info">
                    <div class="stat-number" id="statChapters">0</div>
                    <div class="stat-label">Cap√≠tulos Lidos</div>
                </div>
                <div class="stat-trend" id="chaptersTrend">üìà +1</div>
            </div>
            
            <div class="stat-card badges">
                <div class="stat-icon">üèÜ</div>
                <div class="stat-info">
                    <div class="stat-number" id="statBadges">0</div>
                    <div class="stat-label">Badges Earned</div>
                </div>
                <div class="stat-trend" id="badgesTrend">üìà +1</div>
            </div>
            
            <div class="stat-card time">
                <div class="stat-icon">‚è±Ô∏è</div>
                <div class="stat-info">
                    <div class="stat-number" id="statTime">0h</div>
                    <div class="stat-label">Tempo de Estudo</div>
                </div>
                <div class="stat-trend" id="timeTrend">üìà +1h</div>
            </div>
        </section>
        
        <!-- Main Activities -->
        <main class="hubs-grid">
            <!-- Listening Hub -->
            <div class="hub-card" onclick="navigate('listening')">
                <div class="hub-header">
                    <div class="hub-icon">üéß</div>
                    <h3 class="hub-title-card">Listening Practice</h3>
                    <p class="hub-description">Melhore sua compreens√£o auditiva com di√°logos aut√™nticos</p>
                </div>
                <div class="hub-content">
                    <ul class="hub-features">
                        <li>23 li√ß√µes interativas dispon√≠veis</li>
                        <li>√Åudios nativos de alta qualidade</li>
                        <li>Quiz de compreens√£o din√¢mico</li>
                        <li>Sistema de badges motivador</li>
                        <li>N√≠veis: Foundation ‚Üí Advanced</li>
                    </ul>
                </div>
                <div class="hub-footer">
                    <button class="hub-button">üéß Come√ßar Listening</button>
                </div>
                <div class="progress-badge" id="listeningProgress">‚ú® Pronto</div>
            </div>
            
            <!-- Graded Readers Hub -->
            <div class="hub-card" onclick="navigate('graded-readers')">
                <div class="hub-header">
                    <div class="hub-icon">üìö</div>
                    <h3 class="hub-title-card">Graded Readers</h3>
                    <p class="hub-description">Hist√≥rias organizadas por n√≠vel para absor√ß√£o natural de vocabul√°rio</p>
                </div>
                <div class="hub-content">
                    <ul class="hub-features">
                        <li>N√≠vel A1: The Roommate Problem</li>
                        <li>N√≠vel A2: The Secret House</li>
                        <li>N√≠vel B1: Em desenvolvimento</li>
                        <li>√Åudios IA de alta qualidade</li>
                        <li>Progress√£o did√°tica estruturada</li>
                    </ul>
                </div>
                <div class="hub-footer">
                    <button class="hub-button">üìö Explorar Hist√≥rias</button>
                </div>
                <div class="progress-badge" id="gradedProgress">‚ú® Pronto</div>
            </div>
            
            <!-- Pure Reading Hub -->
            <div class="hub-card" onclick="navigate('pure-reading')">
                <div class="hub-header">
                    <div class="hub-icon">üìñ</div>
                    <h3 class="hub-title-card">Pure Reading</h3>
                    <p class="hub-description">Foco 100% na interpreta√ß√£o textual sem distra√ß√µes</p>
                </div>
                <div class="hub-content">
                    <ul class="hub-features">
                        <li>A2 Low: Perfect Neighbor Story</li>
                        <li>A2 Mid: Hist√≥rias intermedi√°rias</li>
                        <li>B1: Para alunos avan√ßados</li>
                        <li>Leitura pura sem depend√™ncia de √°udio</li>
                        <li>Typography otimizada para leitura</li>
                    </ul>
                </div>
                <div class="hub-footer">
                    <button class="hub-button">üìñ Come√ßar Leitura</button>
                </div>
                <div class="progress-badge" id="pureProgress">‚ú® Pronto</div>
            </div>
            
            <!-- Secret Area -->
            <div class="hub-card coming-soon" onclick="showComingSoon()">
                <div class="hub-header">
                    <div class="hub-icon">üîí</div>
                    <h3 class="hub-title-card">Secret Area</h3>
                    <p class="hub-description">√Årea exclusiva para alunos dedicados e conquistadores</p>
                </div>
                <div class="hub-content">
                    <ul class="hub-features">
                        <li>Conte√∫do premium exclusivo</li>
                        <li>Desafios especiais avan√ßados</li>
                        <li>Certificados de conquista</li>
                        <li>Acesso via badges earned</li>
                        <li>Surpresas para dedicados</li>
                    </ul>
                </div>
                <div class="hub-footer">
                    <button class="hub-button" disabled>üöÄ Em Breve</button>
                </div>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="footer">
            <h3>üéì Teacher Alex English Academy</h3>
            <p>Sua jornada personalizada para dominar o ingl√™s americano!</p>
            <p>Contato direto: <a href="mailto:alexmg@gmail.com" class="contact-link">alexmg@gmail.com</a></p>
        </footer>
    </div>

    <script>
        // ===== ‚úÖ CORRE√á√ÉO #2: PROGRESS SYSTEM ESTABILIZADO =====
        class ProgressManager {
            constructor() {
                this.studentName = sessionStorage.getItem('studentUsername') || 'Student';
                this.progressKey = `progress_${this.studentName}`;
                this.isInitialized = false;
                this.safeInit();
            }

            safeInit() {
                try {
                    this.ensureProgressStructure();
                    this.isInitialized = true;
                    console.log('üìä Progress Manager initialized safely for:', this.studentName);
                } catch (error) {
                    console.error('‚ùå Progress Manager init error:', error);
                    this.createFallbackStructure();
                }
            }

            ensureProgressStructure() {
                const data = this.getAllProgress();
                let updated = false;

                const sections = ['listening', 'reading', 'roommate', 'neighbor'];
                sections.forEach(section => {
                    if (!data[section]) {
                        data[section] = {
                            chaptersCompleted: [],
                            badges: [],
                            lastAccessed: Date.now()
                        };
                        updated = true;
                    }
                });

                if (!data.totalStudyTime) {
                    data.totalStudyTime = 0;
                    updated = true;
                }

                if (updated) {
                    this.saveAllProgress(data);
                    console.log('‚úÖ Progress structure ensured');
                }
            }

            createFallbackStructure() {
                const fallbackData = {
                    listening: { chaptersCompleted: [], badges: [], lastAccessed: Date.now() },
                    reading: { chaptersCompleted: [], badges: [], lastAccessed: Date.now() },
                    roommate: { chaptersCompleted: [], badges: [], lastAccessed: Date.now() },
                    neighbor: { chaptersCompleted: [], badges: [], lastAccessed: Date.now() },
                    totalStudyTime: 0
                };
                this.saveAllProgress(fallbackData);
                this.isInitialized = true;
                console.log('üîÑ Fallback progress structure created');
            }

            getAllProgress() {
                const saved = localStorage.getItem(this.progressKey);
                if (saved) {
                    try {
                        return JSON.parse(saved);
                    } catch (e) {
                        console.error('‚ùå Error parsing progress data:', e);
                        return {};
                    }
                }
                return {};
            }

            saveAllProgress(data) {
                try {
                    localStorage.setItem(this.progressKey, JSON.stringify(data));
                    console.log('üíæ Progress saved successfully');
                } catch (error) {
                    console.error('‚ùå Error saving progress:', error);
                }
            }

            getStatistics() {
                if (!this.isInitialized) {
                    return { lessons: 0, chapters: 0, badges: 0, studyHours: 0, raw: {} };
                }

                const data = this.getAllProgress();
                
                let totalLessons = 0;
                let totalChapters = 0;
                let totalBadges = 0;
                
                Object.keys(data).forEach(key => {
                    if (data[key] && data[key].chaptersCompleted) {
                        if (key === 'listening') {
                            totalLessons += data[key].chaptersCompleted.length;
                        } else {
                            totalChapters += data[key].chaptersCompleted.length;
                        }
                    }
                    
                    if (data[key] && data[key].badges) {
                        totalBadges += data[key].badges.length;
                    }
                });
                
                const studyHours = Math.floor((data.totalStudyTime || 0) / (1000 * 60 * 60));
                
                return {
                    lessons: Math.min(50, Math.max(0, totalLessons)),
                    chapters: Math.min(100, Math.max(0, totalChapters)),
                    badges: Math.min(50, Math.max(0, totalBadges)),
                    studyHours: Math.min(999, Math.max(0, studyHours)),
                    raw: data
                };
            }

            debugProgress() {
                const data = this.getAllProgress();
                const stats = this.getStatistics();
                
                console.log('üîç PROGRESS DEBUG:', {
                    studentName: this.studentName,
                    progressKey: this.progressKey,
                    isInitialized: this.isInitialized,
                    rawData: data,
                    statistics: stats
                });
                
                return { data, stats };
            }
        }

        // ===== ‚úÖ CORRE√á√ÉO #3: AUTH CHECK ESTABILIZADO =====
        function checkAuthSafely() {
            try {
                if (sessionStorage.getItem('studentLoggedIn') !== 'true') {
                    console.log('üö™ User not authenticated, redirecting...');
                    window.location.href = 'pages/auth/login.html';
                    return false;
                }
                return true;
            } catch (error) {
                console.error('‚ùå Auth check error:', error);
                window.location.href = 'pages/auth/login.html';
                return false;
            }
        }

        // ===== ‚úÖ CORRE√á√ÉO #4: TIMER SYSTEM ROBUSTO =====
        class TimerManager {
            constructor() {
                this.activeTimers = new Set();
                this.isClearing = false;
            }

            addTimer(timerId) {
                this.activeTimers.add(timerId);
            }

            removeTimer(timerId) {
                this.activeTimers.delete(timerId);
                if (timerId) {
                    clearInterval(timerId);
                }
            }

            clearAllTimers() {
                if (this.isClearing) return;
                this.isClearing = true;

                try {
                    this.activeTimers.forEach(timerId => {
                        if (timerId) {
                            clearInterval(timerId);
                        }
                    });
                    this.activeTimers.clear();
                    console.log('üßπ All timers cleared safely');
                } catch (error) {
                    console.error('‚ùå Error clearing timers:', error);
                } finally {
                    this.isClearing = false;
                }
            }

            safeInterval(callback, delay) {
                const timerId = setInterval(callback, delay);
                this.addTimer(timerId);
                return timerId;
            }
        }

        // ===== GLOBAL INSTANCES =====
        const timerManager = new TimerManager();
        let progressManager = null;
        let previousStats = null;

        // ===== ‚úÖ CORRE√á√ÉO #5: STATS ANIMATION ESTABILIZADA =====
        function animateStatSafely(elementId, targetValue, previousValue, suffix = '') {
            const element = document.getElementById(elementId);
            if (!element) {
                console.warn(`‚ö†Ô∏è Element ${elementId} not found`);
                return;
            }
            
            // Convert to numbers safely
            const startValue = parseInt(element.textContent.replace(/[^0-9]/g, '')) || 0;
            const target = parseInt(targetValue) || 0;
            
            // Immediate update if no animation needed
            if (target === startValue || target < 0 || target > 1000) {
                element.textContent = target + suffix;
                return;
            }
            
            // Show trend if improvement
            if (target > previousValue) {
                element.classList.add('achievement');
                setTimeout(() => element.classList.remove('achievement'), 2000);
                
                // Update trend indicator
                const trendMap = {
                    'statLessons': 'lessonsTrend',
                    'statChapters': 'chaptersTrend',
                    'statBadges': 'badgesTrend',
                    'statTime': 'timeTrend'
                };
                
                const trendElement = document.getElementById(trendMap[elementId]);
                if (trendElement) {
                    const difference = target - previousValue;
                    trendElement.textContent = `üìà +${difference}${suffix}`;
                    trendElement.classList.add('growing');
                    setTimeout(() => trendElement.classList.remove('growing'), 4000);
                }
            }
            
            // Safe animation with cleanup
            const difference = Math.abs(target - startValue);
            const increment = target > startValue ? 1 : -1;
            const stepTime = Math.max(50, Math.floor(800 / difference));
            
            let currentValue = startValue;
            let steps = 0;
            const maxSteps = Math.min(difference, 20); // Limit animation steps
            
            const timerId = timerManager.safeInterval(() => {
                steps++;
                currentValue += increment;
                element.textContent = currentValue + suffix;
                
                if (currentValue === target || steps >= maxSteps) {
                    timerManager.removeTimer(timerId);
                    element.textContent = target + suffix; // Ensure final value
                }
            }, stepTime);
        }

        function loadStatsSafely() {
            try {
                timerManager.clearAllTimers();
                
                if (!progressManager || !progressManager.isInitialized) {
                    console.warn('‚ö†Ô∏è Progress manager not ready, using default stats');
                    setDefaultStats();
                    return;
                }
                
                const stats = progressManager.getStatistics();
                console.log('üìä Loading stats:', stats);
                
                // Get previous stats for comparison
                const currentStats = { 
                    lessons: stats.lessons, 
                    chapters: stats.chapters, 
                    badges: stats.badges, 
                    time: stats.studyHours 
                };
                
                // Animate with safety checks
                animateStatSafely('statLessons', stats.lessons, previousStats?.lessons || 0);
                animateStatSafely('statChapters', stats.chapters, previousStats?.chapters || 0);
                animateStatSafely('statBadges', stats.badges, previousStats?.badges || 0);
                animateStatSafely('statTime', stats.studyHours, previousStats?.time || 0, 'h');
                
                // Store current stats for next comparison
                previousStats = currentStats;
                localStorage.setItem(`previousStats_${progressManager.studentName}`, JSON.stringify(currentStats));
                
                // Achievement effects
                checkHighAchievements(stats.lessons, stats.chapters, stats.badges, stats.studyHours);
                
                // Update progress badges
                updateProgressBadgesSafely(stats.raw);
                
            } catch (error) {
                console.error('‚ùå Error loading stats:', error);
                setDefaultStats();
            }
        }

        function setDefaultStats() {
            const defaultValues = [
                { id: 'statLessons', value: '0' },
                { id: 'statChapters', value: '0' },
                { id: 'statBadges', value: '0' },
                { id: 'statTime', value: '0h' }
            ];

            defaultValues.forEach(({ id, value }) => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = value;
                }
            });
        }

        function checkHighAchievements(lessons, chapters, badges, hours) {
            try {
                // Remove previous high achiever status
                document.querySelectorAll('.stat-card').forEach(card => {
                    card.classList.remove('high-achiever');
                });
                
                // Add high achiever status based on thresholds
                const achievements = [
                    { selector: '.stat-card.lessons', threshold: lessons >= 5 },
                    { selector: '.stat-card.chapters', threshold: chapters >= 3 },
                    { selector: '.stat-card.badges', threshold: badges >= 3 },
                    { selector: '.stat-card.time', threshold: hours >= 2 }
                ];

                achievements.forEach(({ selector, threshold }) => {
                    if (threshold) {
                        const card = document.querySelector(selector);
                        if (card) {
                            card.classList.add('high-achiever');
                        }
                    }
                });
                
                // Celebration for high achievers
                if (lessons >= 10 || chapters >= 8 || badges >= 5 || hours >= 5) {
                    setTimeout(() => showCelebrationMessage(), 1000);
                }
            } catch (error) {
                console.error('‚ùå Error checking achievements:', error);
            }
        }

        function showCelebrationMessage() {
            const messages = [
                'üéâ Parab√©ns! Voc√™ √© um aluno excepcional!',
                '‚≠ê Seu progresso est√° impressionante!',
                'üèÜ Continue assim - voc√™ est√° indo muito bem!',
                'üî• Dedica√ß√£o exemplar! Keep it up!'
            ];
            
            const randomMessage = messages[Math.floor(Math.random() * messages.length)];
            if (confirm(randomMessage + '\n\nQuer continuar estudando?')) {
                console.log('‚ú® Student motivated to continue!');
            }
        }

        function updateProgressBadgesSafely(data) {
            try {
                const badges = [
                    {
                        id: 'listeningProgress',
                        completed: data.listening?.chaptersCompleted?.length || 0,
                        defaultText: '‚ú® Pronto'
                    },
                    {
                        id: 'gradedProgress', 
                        completed: (data.roommate?.chaptersCompleted?.length || 0) + (data.reading?.chaptersCompleted?.length || 0),
                        defaultText: '‚ú® Pronto'
                    },
                    {
                        id: 'pureProgress',
                        completed: data.neighbor?.chaptersCompleted?.length || 0,
                        defaultText: '‚ú® Pronto'
                    }
                ];

                badges.forEach(({ id, completed, defaultText }) => {
                    const badge = document.getElementById(id);
                    if (badge) {
                        if (completed > 0) {
                            badge.textContent = `${completed} ‚úì`;
                            badge.style.background = 'var(--success)';
                            badge.style.color = 'white';
                        } else {
                            badge.textContent = defaultText;
                            badge.style.background = 'var(--blue-medium)';
                            badge.style.color = 'white';
                        }
                    }
                });
            } catch (error) {
                console.error('‚ùå Error updating progress badges:', error);
            }
        }

        // ===== ‚úÖ CORRE√á√ÉO #6: NAVIGATION ESTABILIZADA =====
        function navigate(section) {
            const card = event.currentTarget;
            const button = card.querySelector('.hub-button');
            if (!button) return;
            
            const originalText = button.textContent;
            
            // Prevent double clicks
            if (button.disabled || button.textContent.includes('Carregando')) {
                return;
            }
            
            // Loading state
            button.textContent = 'Carregando...';
            button.disabled = true;
            card.style.opacity = '0.7';
            
            const routes = {
                'listening': 'pages/hubs/listening-hub.html',
                'graded-readers': 'pages/hubs/graded-readers-hub.html',
                'pure-reading': 'pages/hubs/pure-reading-hub.html'
            };
            
            // Safety reset timer
            const resetTimer = setTimeout(() => {
                button.textContent = originalText;
                button.disabled = false;
                card.style.opacity = '1';
            }, 5000);
            
            setTimeout(() => {
                if (routes[section]) {
                    clearTimeout(resetTimer);
                    window.location.href = routes[section];
                } else {
                    clearTimeout(resetTimer);
                    button.textContent = originalText;
                    button.disabled = false;
                    card.style.opacity = '1';
                    alert('üöÄ Se√ß√£o em desenvolvimento!');
                }
            }, 300);
        }

        function showComingSoon() {
            const messages = [
                'üîí A Secret Area est√° sendo preparada especialmente para voc√™s!',
                'üèÜ Continue ganhando badges para desbloquear conte√∫do exclusivo!',
                '‚≠ê Algo incr√≠vel est√° vindo para os alunos mais dedicados!',
                'üéØ Mantenha o foco nos estudos - surpresas est√£o chegando!'
            ];
            alert(messages[Math.floor(Math.random() * messages.length)]);
        }

        // ===== LOGOUT FUNCTION =====
        function logout() {
            if (confirm('Tem certeza que deseja sair?')) {
                timerManager.clearAllTimers();
                sessionStorage.clear();
                window.location.href = 'pages/auth/login.html';
            }
        }

        // ===== ‚úÖ CORRE√á√ÉO #7: INITIALIZATION ROBUSTO =====
        function initializeDashboard() {
            try {
                // 1. Check auth first
                if (!checkAuthSafely()) {
                    return;
                }

                // 2. Initialize progress manager
                progressManager = new ProgressManager();

                // 3. Load previous stats
                const studentName = sessionStorage.getItem('studentUsername') || 'Student';
                previousStats = JSON.parse(localStorage.getItem(`previousStats_${studentName}`)) || {
                    lessons: 0, chapters: 0, badges: 0, time: 0
                };

                // 4. Update UI
                document.getElementById('userName').textContent = studentName;
                document.getElementById('userAvatar').textContent = studentName.charAt(0).toUpperCase();
                document.getElementById('welcomeMsg').textContent = `Bem-vindo de volta, ${studentName}!`;

                // 5. Load stats
                loadStatsSafely();

                console.log('‚úÖ Dashboard initialized successfully');
                console.log(`üë§ User: ${studentName}`);
                console.log('üìä Progress Manager active');

            } catch (error) {
                console.error('‚ùå Dashboard initialization error:', error);
                // Fallback initialization
                setDefaultStats();
            }
        }

        // ===== ‚úÖ CORRE√á√ÉO #8: CLEANUP EVENTS =====
        let sessionStartTime = Date.now();
        
        window.addEventListener('beforeunload', () => {
            timerManager.clearAllTimers();
            
            if (progressManager && progressManager.isInitialized) {
                const sessionTime = Date.now() - sessionStartTime;
                if (sessionTime > 0) {
                    const data = progressManager.getAllProgress();
                    data.totalStudyTime = (data.totalStudyTime || 0) + sessionTime;
                    progressManager.saveAllProgress(data);
                }
            }
        });

        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                timerManager.clearAllTimers();
            }
        });

        // ===== PWA SERVICE WORKER =====
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then(registration => {
                    console.log('üîß Service Worker registered successfully:', registration);
                })
                .catch(error => {
                    console.log('‚ùå Service Worker registration failed:', error);
                });
        }

        // ===== GLOBAL DEBUG FUNCTIONS =====
        window.progressManager = () => progressManager;
        window.clearStatsAnimations = function() {
            timerManager.clearAllTimers();
            setDefaultStats();
            console.log('üÜò Stats animations cleared successfully!');
        };

        window.debugProgress = function() {
            return progressManager ? progressManager.debugProgress() : { error: 'Progress manager not initialized' };
        };

        window.forceRefreshStats = function() {
            console.log('üîÑ Forcing stats refresh...');
            timerManager.clearAllTimers();
            loadStatsSafely();
        };

        window.simulateProgress = function() {
            if (!progressManager) {
                console.error('‚ùå Progress manager not available');
                return;
            }

            const testData = {
                listening: {
                    chaptersCompleted: [1, 2, 3],
                    badges: ['beginner', 'intermediate']
                },
                reading: {
                    chaptersCompleted: [1, 2],
                    badges: ['reader']
                },
                roommate: {
                    chaptersCompleted: [1, 2, 3],
                    badges: ['story-lover']
                },
                neighbor: {
                    chaptersCompleted: [1],
                    badges: ['neighbor-friend']
                },
                totalStudyTime: 7200000
            };
            
            progressManager.saveAllProgress(testData);
            console.log('‚úÖ Test data saved!');
            forceRefreshStats();
        };

        // ===== LISTEN FOR PROGRESS UPDATES =====
        window.addEventListener('progressUpdated', (event) => {
            console.log('üìä Progress update received:', event.detail);
            setTimeout(() => {
                forceRefreshStats();
            }, 500);
        });

        // ===== FINAL INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ DOM loaded, initializing dashboard...');
            
            // Small delay to ensure all scripts loaded
            setTimeout(() => {
                initializeDashboard();
            }, 100);
        });
        
        console.log('üéì TEACHER ALEX ENGLISH ACADEMY - INDEX ESTABILIZADO!');
        console.log('‚úÖ CORRE√á√ïES APLICADAS:');
        console.log('  1. Path navigation-fix.js corrigido');
        console.log('  2. Timer system robusto implementado');
        console.log('  3. Progress manager estabilizado');
        console.log('  4. Auth check com fallbacks');
        console.log('  5. Stats animation safeguardada');
        console.log('  6. Navigation com anti-double-click');
        console.log('  7. Cleanup events otimizados');
        console.log('  8. Memory leak prevention');
        console.log('');
        console.log('üî• PARA TESTAR:');
        console.log('   1. simulateProgress() - criar dados teste');
        console.log('   2. debugProgress() - ver dados atuais');
        console.log('   3. forceRefreshStats() - atualizar dashboard');
        console.log('   4. clearStatsAnimations() - emergency reset');
    </script>
</body>
</html>
