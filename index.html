<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Alex English Academy</title>
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2b4c7e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <!-- FAVICON -->
    <link rel="icon" href="src/assets/images/icons/icon-192.png" type="image/png">
    <link rel="apple-touch-icon" href="src/assets/images/icons/icon-192.png">
    
    <!-- CSS Universal -->
    <link rel="stylesheet" href="src/styles/base.css">
    <link rel="stylesheet" href="src/styles/layout.css">
    <link rel="stylesheet" href="src/styles/theme-patriot.css">
</head>
<body>
    <!-- User Widget -->
    <div class="user-widget">
        <div class="user-avatar" id="userAvatar">A</div>
        <span class="user-name" id="userName">Aluno</span>
        <button class="logout-btn" onclick="logout()">Sair</button>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1 class="logo">Teacher Alex <span class="logo-highlight">English Academy</span></h1>
            <p class="main-subtitle" id="welcomeMsg">Bem-vindo de volta!</p>
        </header>
        
        <!-- Stats Section -->
        <section class="stats-section">
            <h2 class="stats-title">📊 Seu Progresso Acadêmico</h2>
            <p class="stats-subtitle">Acompanhe sua jornada de aprendizado em tempo real</p>
        </section>
        
        <!-- Stats Dashboard -->
        <section class="stats-dashboard">
            <div class="stat-card lessons">
                <div class="stat-icon">📚</div>
                <div class="stat-info">
                    <div class="stat-number" id="statLessons">0</div>
                    <div class="stat-label">Lições Completas</div>
                </div>
            </div>
            
            <div class="stat-card chapters">
                <div class="stat-icon">📖</div>
                <div class="stat-info">
                    <div class="stat-number" id="statChapters">0</div>
                    <div class="stat-label">Capítulos Lidos</div>
                </div>
            </div>
            
            <div class="stat-card badges">
                <div class="stat-icon">🏆</div>
                <div class="stat-info">
                    <div class="stat-number" id="statBadges">0</div>
                    <div class="stat-label">Badges Earned</div>
                </div>
            </div>
            
            <div class="stat-card time">
                <div class="stat-icon">⏱️</div>
                <div class="stat-info">
                    <div class="stat-number" id="statTime">0h</div>
                    <div class="stat-label">Tempo de Estudo</div>
                </div>
            </div>
        </section>
        
        <!-- Main Activities -->
        <main class="hubs-grid">
            <!-- Listening Hub -->
            <div class="hub-card" onclick="goToListening()">
                <div class="hub-header">
                    <div class="hub-icon">🎧</div>
                    <h3 class="hub-title-card">Listening Practice</h3>
                    <p class="hub-description">Melhore sua compreensão auditiva com diálogos autênticos</p>
                </div>
                <div class="hub-content">
                    <ul class="hub-features">
                        <li>23 lições interativas disponíveis</li>
                        <li>Áudios nativos de alta qualidade</li>
                        <li>Quiz de compreensão dinâmico</li>
                        <li>Sistema de badges motivador</li>
                        <li>Níveis: Foundation → Advanced</li>
                    </ul>
                </div>
                <div class="hub-footer">
                    <button class="hub-button">🎧 Começar Listening</button>
                </div>
                <div class="progress-badge" id="listeningProgress">✨ Pronto</div>
            </div>
            
            <!-- Graded Readers Hub -->
            <div class="hub-card" onclick="goToGradedReaders()">
                <div class="hub-header">
                    <div class="hub-icon">📚</div>
                    <h3 class="hub-title-card">Graded Readers</h3>
                    <p class="hub-description">Histórias organizadas por nível para absorção natural de vocabulário</p>
                </div>
                <div class="hub-content">
                    <ul class="hub-features">
                        <li>Nível A1: The Roommate Problem</li>
                        <li>Nível A2: The Secret House</li>
                        <li>Nível B1: Em desenvolvimento</li>
                        <li>Áudios IA de alta qualidade</li>
                        <li>Progressão didática estruturada</li>
                    </ul>
                </div>
                <div class="hub-footer">
                    <button class="hub-button">📚 Explorar Histórias</button>
                </div>
                <div class="progress-badge" id="gradedProgress">✨ Pronto</div>
            </div>
            
            <!-- Pure Reading Hub -->
            <div class="hub-card" onclick="goToPureReading()">
                <div class="hub-header">
                    <div class="hub-icon">📖</div>
                    <h3 class="hub-title-card">Pure Reading</h3>
                    <p class="hub-description">Foco 100% na interpretação textual sem distrações</p>
                </div>
                <div class="hub-content">
                    <ul class="hub-features">
                        <li>A2 Low: Perfect Neighbor Story</li>
                        <li>A2 Mid: Histórias intermediárias</li>
                        <li>B1: Para alunos avançados</li>
                        <li>Leitura pura sem dependência de áudio</li>
                        <li>Typography otimizada para leitura</li>
                    </ul>
                </div>
                <div class="hub-footer">
                    <button class="hub-button">📖 Começar Leitura</button>
                </div>
                <div class="progress-badge" id="pureProgress">✨ Pronto</div>
            </div>
            
            <!-- Secret Area -->
            <div class="hub-card coming-soon" onclick="showComingSoon()">
                <div class="hub-header">
                    <div class="hub-icon">🔒</div>
                    <h3 class="hub-title-card">Secret Area</h3>
                    <p class="hub-description">Área exclusiva para alunos dedicados e conquistadores</p>
                </div>
                <div class="hub-content">
                    <ul class="hub-features">
                        <li>Conteúdo premium exclusivo</li>
                        <li>Desafios especiais avançados</li>
                        <li>Certificados de conquista</li>
                        <li>Acesso via badges earned</li>
                        <li>Surpresas para dedicados</li>
                    </ul>
                </div>
                <div class="hub-footer">
                    <button class="hub-button" disabled>🚀 Em Breve</button>
                </div>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="footer">
            <h3>🎓 Teacher Alex English Academy</h3>
            <p>Sua jornada personalizada para dominar o inglês americano!</p>
            <p>Contato direto: <a href="mailto:alexmg@gmail.com" class="contact-link">alexmg@gmail.com</a></p>
        </footer>
    </div>

    <script>
        // ===== AUTH CHECK =====
        if (sessionStorage.getItem('studentLoggedIn') !== 'true') {
            window.location.href = 'pages/auth/login.html';
        }

        // ===== 🔧 NAVEGAÇÃO SIMPLES SEM TRAVAMENTO =====
        function goToListening() {
            window.location.href = 'pages/hubs/listening-hub.html';
        }

        function goToGradedReaders() {
            window.location.href = 'pages/hubs/graded-readers-hub.html';
        }

        function goToPureReading() {
            window.location.href = 'pages/hubs/pure-reading-hub.html';
        }

        function showComingSoon() {
            alert('🔒 A Secret Area está sendo preparada especialmente para vocês!');
        }

        function logout() {
            if (confirm('Tem certeza que deseja sair?')) {
                sessionStorage.clear();
                window.location.href = 'pages/auth/login.html';
            }
        }

        // ===== SIMPLE PROGRESS SYSTEM =====
        function loadStats() {
            try {
                const studentName = sessionStorage.getItem('studentUsername') || 'Student';
                const progressKey = `progress_${studentName}`;
                const saved = localStorage.getItem(progressKey);
                
                if (!saved) return;
                
                const data = JSON.parse(saved);
                let totalLessons = 0;
                let totalChapters = 0;
                let totalBadges = 0;
                
                // Count lessons and chapters
                Object.keys(data).forEach(key => {
                    if (data[key] && data[key].chaptersCompleted) {
                        if (key === 'listening') {
                            totalLessons += data[key].chaptersCompleted.length;
                        } else {
                            totalChapters += data[key].chaptersCompleted.length;
                        }
                    }
                    
                    if (data[key] && data[key].badges) {
                        totalBadges += data[key].badges.length;
                    }
                });
                
                const studyHours = Math.floor((data.totalStudyTime || 0) / (1000 * 60 * 60));
                
                // Update UI
                document.getElementById('statLessons').textContent = Math.min(50, totalLessons);
                document.getElementById('statChapters').textContent = Math.min(100, totalChapters);
                document.getElementById('statBadges').textContent = Math.min(50, totalBadges);
                document.getElementById('statTime').textContent = Math.min(999, studyHours) + 'h';
                
                // Update progress badges
                updateProgressBadges(data);
                
            } catch (e) {
                console.log('Erro carregando stats:', e);
            }
        }

        function updateProgressBadges(data) {
            // Listening
            const listeningCompleted = data.listening?.chaptersCompleted?.length || 0;
            const listeningBadge = document.getElementById('listeningProgress');
            listeningBadge.textContent = listeningCompleted > 0 ? `${listeningCompleted} ✓` : '✨ Pronto';
            if (listeningCompleted > 0) {
                listeningBadge.style.background = 'var(--success)';
                listeningBadge.style.color = 'white';
            }
            
            // Graded Readers
            const gradedCompleted = (data.roommate?.chaptersCompleted?.length || 0) + (data.reading?.chaptersCompleted?.length || 0);
            const gradedBadge = document.getElementById('gradedProgress');
            gradedBadge.textContent = gradedCompleted > 0 ? `${gradedCompleted} ✓` : '✨ Pronto';
            if (gradedCompleted > 0) {
                gradedBadge.style.background = 'var(--success)';
                gradedBadge.style.color = 'white';
            }
            
            // Pure Reading
            const pureCompleted = data.neighbor?.chaptersCompleted?.length || 0;
            const pureBadge = document.getElementById('pureProgress');
            pureBadge.textContent = pureCompleted > 0 ? `${pureCompleted} ✓` : '✨ Pronto';
            if (pureCompleted > 0) {
                pureBadge.style.background = 'var(--success)';
                pureBadge.style.color = 'white';
            }
        }

        // ===== INITIALIZATION =====
        function init() {
            const studentName = sessionStorage.getItem('studentUsername') || 'Student';
            
            // Update UI
            document.getElementById('userName').textContent = studentName;
            document.getElementById('userAvatar').textContent = studentName.charAt(0).toUpperCase();
            document.getElementById('welcomeMsg').textContent = `Bem-vindo de volta, ${studentName}!`;
            
            // Load stats
            loadStats();
            
            console.log('✅ Dashboard inicializado - SEM TRAVAMENTO');
        }

        // ===== START =====
        document.addEventListener('DOMContentLoaded', init);

        // ===== SERVICE WORKER =====
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js');
        }
    </script>
</body>
</html>
