<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Alex English Academy</title>
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2b4c7e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <!-- CSS Universal -->
    <link rel="stylesheet" href="src/styles/base.css">
    <link rel="stylesheet" href="src/styles/layout.css">
    <link rel="stylesheet" href="src/styles/theme-patriot.css">
</head>
<body>
    <!-- User Widget -->
    <div class="user-widget">
        <div class="user-avatar" id="userAvatar">A</div>
        <span class="user-name" id="userName">Aluno</span>
        <button class="logout-btn" onclick="logout()">Sair</button>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1 class="logo">Teacher Alex <span class="logo-highlight">English Academy</span></h1>
            <p class="main-subtitle" id="welcomeMsg">Bem-vindo de volta!</p>
        </header>
        
        <!-- Stats Section Title -->
        <section class="stats-section">
            <h2 class="stats-title">ğŸ“Š Seu Progresso AcadÃªmico</h2>
            <p class="stats-subtitle">Acompanhe sua jornada de aprendizado em tempo real</p>
        </section>
        
        <!-- Stats Dashboard -->
        <section class="stats-dashboard">
            <div class="stat-card lessons">
                <div class="stat-icon">ğŸ“š</div>
                <div class="stat-info">
                    <div class="stat-number" id="statLessons">0</div>
                    <div class="stat-label">LiÃ§Ãµes Completas</div>
                </div>
                <div class="stat-trend" id="lessonsTrend">ğŸ“ˆ +1</div>
            </div>
            
            <div class="stat-card chapters">
                <div class="stat-icon">ğŸ“–</div>
                <div class="stat-info">
                    <div class="stat-number" id="statChapters">0</div>
                    <div class="stat-label">CapÃ­tulos Lidos</div>
                </div>
                <div class="stat-trend" id="chaptersTrend">ğŸ“ˆ +1</div>
            </div>
            
            <div class="stat-card badges">
                <div class="stat-icon">ğŸ†</div>
                <div class="stat-info">
                    <div class="stat-number" id="statBadges">0</div>
                    <div class="stat-label">Badges Earned</div>
                </div>
                <div class="stat-trend" id="badgesTrend">ğŸ“ˆ +1</div>
            </div>
            
            <div class="stat-card time">
                <div class="stat-icon">â±ï¸</div>
                <div class="stat-info">
                    <div class="stat-number" id="statTime">0h</div>
                    <div class="stat-label">Tempo de Estudo</div>
                </div>
                <div class="stat-trend" id="timeTrend">ğŸ“ˆ +1h</div>
            </div>
        </section>
        
        <!-- Main Activities -->
        <main class="hubs-grid">
            <!-- Listening Hub -->
            <div class="hub-card" onclick="navigate('listening')">
                <div class="hub-header">
                    <div class="hub-icon">ğŸ§</div>
                    <h3 class="hub-title-card">Listening Practice</h3>
                    <p class="hub-description">Melhore sua compreensÃ£o auditiva com diÃ¡logos autÃªnticos</p>
                </div>
                <div class="hub-content">
                    <ul class="hub-features">
                        <li>23 liÃ§Ãµes interativas disponÃ­veis</li>
                        <li>Ãudios nativos de alta qualidade</li>
                        <li>Quiz de compreensÃ£o dinÃ¢mico</li>
                        <li>Sistema de badges motivador</li>
                        <li>NÃ­veis: Foundation â†’ Advanced</li>
                    </ul>
                </div>
                <div class="hub-footer">
                    <button class="hub-button">ğŸ§ ComeÃ§ar Listening</button>
                </div>
                <div class="progress-badge" id="listeningProgress">âœ¨ Pronto</div>
            </div>
            
            <!-- Graded Readers Hub -->
            <div class="hub-card" onclick="navigate('graded-readers')">
                <div class="hub-header">
                    <div class="hub-icon">ğŸ“š</div>
                    <h3 class="hub-title-card">Graded Readers</h3>
                    <p class="hub-description">HistÃ³rias organizadas por nÃ­vel para absorÃ§Ã£o natural de vocabulÃ¡rio</p>
                </div>
                <div class="hub-content">
                    <ul class="hub-features">
                        <li>NÃ­vel A1: The Roommate Problem</li>
                        <li>NÃ­vel A2: The Secret House</li>
                        <li>NÃ­vel B1: Em desenvolvimento</li>
                        <li>Ãudios IA de alta qualidade</li>
                        <li>ProgressÃ£o didÃ¡tica estruturada</li>
                    </ul>
                </div>
                <div class="hub-footer">
                    <button class="hub-button">ğŸ“š Explorar HistÃ³rias</button>
                </div>
                <div class="progress-badge" id="gradedProgress">âœ¨ Pronto</div>
            </div>
            
            <!-- Pure Reading Hub -->
            <div class="hub-card" onclick="navigate('pure-reading')">
                <div class="hub-header">
                    <div class="hub-icon">ğŸ“–</div>
                    <h3 class="hub-title-card">Pure Reading</h3>
                    <p class="hub-description">Foco 100% na interpretaÃ§Ã£o textual sem distraÃ§Ãµes</p>
                </div>
                <div class="hub-content">
                    <ul class="hub-features">
                        <li>A2 Low: Perfect Neighbor Story</li>
                        <li>A2 Mid: HistÃ³rias intermediÃ¡rias</li>
                        <li>B1: Para alunos avanÃ§ados</li>
                        <li>Leitura pura sem dependÃªncia de Ã¡udio</li>
                        <li>Typography otimizada para leitura</li>
                    </ul>
                </div>
                <div class="hub-footer">
                    <button class="hub-button">ğŸ“– ComeÃ§ar Leitura</button>
                </div>
                <div class="progress-badge" id="pureProgress">âœ¨ Pronto</div>
            </div>
            
            <!-- Secret Area -->
            <div class="hub-card coming-soon" onclick="showComingSoon()">
                <div class="hub-header">
                    <div class="hub-icon">ğŸ”’</div>
                    <h3 class="hub-title-card">Secret Area</h3>
                    <p class="hub-description">Ãrea exclusiva para alunos dedicados e conquistadores</p>
                </div>
                <div class="hub-content">
                    <ul class="hub-features">
                        <li>ConteÃºdo premium exclusivo</li>
                        <li>Desafios especiais avanÃ§ados</li>
                        <li>Certificados de conquista</li>
                        <li>Acesso via badges earned</li>
                        <li>Surpresas para dedicados</li>
                    </ul>
                </div>
                <div class="hub-footer">
                    <button class="hub-button" disabled>ğŸš€ Em Breve</button>
                </div>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="footer">
            <h3>ğŸ“ Teacher Alex English Academy</h3>
            <p>Sua jornada personalizada para dominar o inglÃªs americano!</p>
            <p>Contato direto: <a href="mailto:alexmg@gmail.com" class="contact-link">alexmg@gmail.com</a></p>
        </footer>
    </div>

    <script>
        // ===== AUTH CHECK =====
        if (sessionStorage.getItem('studentLoggedIn') !== 'true') {
            window.location.href = 'pages/auth/login.html';
        }

        // ===== INITIALIZATION =====
        const studentName = sessionStorage.getItem('studentUsername') || 'Student';
        
        // Store previous stats for comparison
        let previousStats = JSON.parse(localStorage.getItem(`previousStats_${studentName}`)) || {
            lessons: 0, chapters: 0, badges: 0, time: 0
        };
        
        // Update UI with student info
        document.getElementById('userName').textContent = studentName;
        document.getElementById('userAvatar').textContent = studentName.charAt(0).toUpperCase();
        document.getElementById('welcomeMsg').textContent = `Bem-vindo de volta, ${studentName}!`;

        // ===== STATS DASHBOARD =====
        function loadStats() {
            const progressKey = `progress_${studentName}`;
            const saved = localStorage.getItem(progressKey);
            
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    
                    // Calculate lessons completed
                    const listeningLessons = data.listening?.lessonsCompleted?.length || 0;
                    const totalLessons = listeningLessons;
                    
                    // Calculate chapters completed
                    const readingChapters = data.reading?.chaptersCompleted?.length || 0;
                    const roommateChapters = data.roommate?.chaptersCompleted?.length || 0;
                    const neighborChapters = data.neighbor?.chaptersCompleted?.length || 0;
                    const totalChapters = readingChapters + roommateChapters + neighborChapters;
                    
                    // Calculate badges earned
                    const listeningBadges = data.listening?.badges?.length || 0;
                    const readingBadges = data.reading?.badges?.length || 0;
                    const roommateBadges = data.roommate?.badges?.length || 0;
                    const neighborBadges = data.neighbor?.badges?.length || 0;
                    const totalBadges = listeningBadges + readingBadges + roommateBadges + neighborBadges;
                    
                    // Calculate study time (convert from milliseconds to hours)
                    const totalStudyTime = data.totalStudyTime || 0;
                    const studyHours = Math.floor(totalStudyTime / (1000 * 60 * 60));
                    
                    // Compare with previous stats for trend indicators
                    const currentStats = { lessons: totalLessons, chapters: totalChapters, badges: totalBadges, time: studyHours };
                    
                    // Animate numbers updating with trend comparison
                    animateStatWithTrend('statLessons', totalLessons, previousStats.lessons);
                    animateStatWithTrend('statChapters', totalChapters, previousStats.chapters);
                    animateStatWithTrend('statBadges', totalBadges, previousStats.badges);
                    animateStatWithTrend('statTime', studyHours, previousStats.time, 'h');
                    
                    // Store current stats as previous for next time
                    localStorage.setItem(`previousStats_${studentName}`, JSON.stringify(currentStats));
                    
                    // Debug info
                    console.log('ğŸ“Š Stats calculados:', currentStats);
                    console.log('ğŸ“ˆ Progresso desde Ãºltima sessÃ£o:', {
                        lessons: totalLessons - previousStats.lessons,
                        chapters: totalChapters - previousStats.chapters,
                        badges: totalBadges - previousStats.badges,
                        time: studyHours - previousStats.time
                    });
                    
                    // Add special effects for high achievers
                    checkHighAchievements(totalLessons, totalChapters, totalBadges, studyHours);
                    
                    // Update progress badges based on completion
                    updateProgressBadges(data);
                    
                } catch (e) {
                    console.error('Erro ao carregar estatÃ­sticas:', e);
                    // Set default values if there's an error
                    setDefaultStats();
                    updateProgressBadges({});
                }
            } else {
                // Set default values for new users
                setDefaultStats();
            }
        }

        function animateStatNumber(elementId, targetValue, suffix = '') {
            const element = document.getElementById(elementId);
            const startValue = parseInt(element.textContent) || 0;
            const increment = targetValue > startValue ? 1 : -1;
            const stepTime = Math.abs(Math.floor(300 / (targetValue - startValue)));
            
            // Show trend indicator if increasing
            if (targetValue > startValue) {
                element.classList.add('achievement');
                setTimeout(() => element.classList.remove('achievement'), 2000);
                
                // Show trend indicator
                const trendMap = {
                    'statLessons': 'lessonsTrend',
                    'statChapters': 'chaptersTrend',
                    'statBadges': 'badgesTrend',
                    'statTime': 'timeTrend'
                };
                
                const trendElement = document.getElementById(trendMap[elementId]);
                if (trendElement) {
                    const difference = targetValue - startValue;
                    trendElement.textContent = `ğŸ“ˆ +${difference}${suffix}`;
                    trendElement.classList.add('growing');
                    setTimeout(() => trendElement.classList.remove('growing'), 4000);
                }
            }
            
            let currentValue = startValue;
            const timer = setInterval(() => {
                currentValue += increment;
                element.textContent = currentValue + suffix;
                
                if (currentValue === targetValue) {
                    clearInterval(timer);
                }
            }, stepTime);
        }

        function checkHighAchievements(lessons, chapters, badges, hours) {
            // Remove any existing high-achiever classes
            document.querySelectorAll('.stat-card').forEach(card => {
                card.classList.remove('high-achiever');
            });
            
            // Add high-achiever effect for significant milestones
            const lessonsCard = document.querySelector('.stat-card.lessons');
            const chaptersCard = document.querySelector('.stat-card.chapters');
            const badgesCard = document.querySelector('.stat-card.badges');
            const timeCard = document.querySelector('.stat-card.time');
            
            if (lessons >= 5 && lessonsCard) {
                lessonsCard.classList.add('high-achiever');
            }
            if (chapters >= 3 && chaptersCard) {
                chaptersCard.classList.add('high-achiever');
            }
            if (badges >= 3 && badgesCard) {
                badgesCard.classList.add('high-achiever');
            }
            if (hours >= 2 && timeCard) {
                timeCard.classList.add('high-achiever');
            }
            
            // Special celebration for exceptional achievements
            if (lessons >= 10 || chapters >= 8 || badges >= 5 || hours >= 5) {
                showCelebrationMessage();
            }
        }

        function showCelebrationMessage() {
            const messages = [
                'ğŸ‰ ParabÃ©ns! VocÃª Ã© um aluno excepcional!',
                'â­ Seu progresso estÃ¡ impressionante!',
                'ğŸ† Continue assim - vocÃª estÃ¡ indo muito bem!',
                'ğŸ”¥ DedicaÃ§Ã£o exemplar! Keep it up!'
            ];
            
            setTimeout(() => {
                const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                if (confirm(randomMessage + '\n\nQuer continuar estudando?')) {
                    // User clicked OK, they want to continue
                    console.log('Aluno motivado a continuar!');
                }
            }, 2000);
        }

        function setDefaultStats() {
            animateStatNumber('statLessons', 0);
            animateStatNumber('statChapters', 0);
            animateStatNumber('statBadges', 0);
            animateStatNumber('statTime', 0, 'h');
        }

        function updateProgressBadges(data) {
            // Listening progress
            const listeningCompleted = data.listening?.lessonsCompleted?.length || 0;
            const listeningBadge = document.getElementById('listeningProgress');
            if (listeningBadge) {
                if (listeningCompleted > 0) {
                    listeningBadge.textContent = `${listeningCompleted} âœ“`;
                    listeningBadge.style.background = 'var(--success)';
                } else {
                    listeningBadge.textContent = 'âœ¨ Pronto';
                    listeningBadge.style.background = 'var(--blue-medium)';
                }
            }
            
            // Graded readers progress
            const roommateCompleted = data.roommate?.chaptersCompleted?.length || 0;
            const readingCompleted = data.reading?.chaptersCompleted?.length || 0;
            const gradedBadge = document.getElementById('gradedProgress');
            if (gradedBadge) {
                const totalGradedChapters = roommateCompleted + readingCompleted;
                if (totalGradedChapters > 0) {
                    gradedBadge.textContent = `${totalGradedChapters} âœ“`;
                    gradedBadge.style.background = 'var(--success)';
                } else {
                    gradedBadge.textContent = 'âœ¨ Pronto';
                    gradedBadge.style.background = 'var(--blue-medium)';
                }
            }
            
            // Pure reading progress
            const neighborCompleted = data.neighbor?.chaptersCompleted?.length || 0;
            const pureBadge = document.getElementById('pureProgress');
            if (pureBadge) {
                if (neighborCompleted > 0) {
                    pureBadge.textContent = `${neighborCompleted} âœ“`;
                    pureBadge.style.background = 'var(--success)';
                } else {
                    pureBadge.textContent = 'âœ¨ Pronto';
                    pureBadge.style.background = 'var(--blue-medium)';
                }
            }
        }

        // ===== NAVIGATION SYSTEM =====
        function navigate(section) {
            const card = event.currentTarget;
            const button = card.querySelector('.hub-button');
            const originalText = button.textContent;
            
            // Loading state
            button.textContent = 'Carregando...';
            card.style.opacity = '0.7';
            
            const routes = {
                'listening': 'pages/hubs/listening-hub.html',
                'graded-readers': 'pages/hubs/graded-readers-hub.html',
                'pure-reading': 'pages/hubs/pure-reading-hub.html'
            };
            
            setTimeout(() => {
                if (routes[section]) {
                    window.location.href = routes[section];
                } else {
                    // Restore button if route doesn't exist
                    button.textContent = originalText;
                    card.style.opacity = '1';
                    alert('ğŸš€ SeÃ§Ã£o em desenvolvimento!');
                }
            }, 500);
        }

        function showComingSoon() {
            const messages = [
                'ğŸ”’ A Secret Area estÃ¡ sendo preparada especialmente para vocÃªs!',
                'ğŸ† Continue ganhando badges para desbloquear conteÃºdo exclusivo!',
                'â­ Algo incrÃ­vel estÃ¡ vindo para os alunos mais dedicados!',
                'ğŸ¯ Mantenha o foco nos estudos - surpresas estÃ£o chegando!'
            ];
            alert(messages[Math.floor(Math.random() * messages.length)]);
        }

        // ===== LOGOUT FUNCTION =====
        function logout() {
            if (confirm('Tem certeza que deseja sair?')) {
                sessionStorage.clear();
                window.location.href = 'pages/auth/login.html';
            }
        }

        // ===== PWA SERVICE WORKER =====
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then(registration => {
                    console.log('ğŸ”§ Service Worker registrado com sucesso:', registration);
                })
                .catch(error => {
                    console.log('âŒ Falha ao registrar Service Worker:', error);
                });
        }

        // ===== STUDY TIME TRACKING =====
        let sessionStartTime = Date.now();
        
        // Track study time when user leaves
        window.addEventListener('beforeunload', () => {
            const sessionTime = Date.now() - sessionStartTime;
            const progressKey = `progress_${studentName}`;
            const saved = localStorage.getItem(progressKey);
            
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    data.totalStudyTime = (data.totalStudyTime || 0) + sessionTime;
                    localStorage.setItem(progressKey, JSON.stringify(data));
                } catch (e) {
                    console.error('Erro ao salvar tempo de estudo:', e);
                }
            }
        });

        // ===== INITIALIZATION =====
        loadStats();
        
        console.log('ğŸ“ TEACHER ALEX ENGLISH ACADEMY carregado!');
        console.log('ğŸ‘¤ UsuÃ¡rio logado:', studentName);
        console.log('ğŸ“Š STATS PREMIUM ativado: gradientes, animaÃ§Ãµes, tendÃªncias, conquistas');
        console.log('âœ¨ Recursos especiais: high-achiever effects, celebration messages, trend indicators');
        console.log('ğŸ¯ Sistema de motivaÃ§Ã£o completo para alunos adultos!');
    </script>
</body>
</html>
