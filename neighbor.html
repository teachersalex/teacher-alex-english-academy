<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Perfect Neighbor - Teacher Alex English Academy BETA</title>
    
    <!-- CSS EXTERNO -->
    <link rel="stylesheet" href="base.css">
    <link rel="stylesheet" href="layout.css">
    <link rel="stylesheet" href="theme-patriot.css">

    <style>
        /* REDESIGN COMPLETO - MODERN & CLEAN */
        
        /* Header espec√≠fico da hist√≥ria */
        .story-header {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        .story-header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 4px;
            background: linear-gradient(90deg, #6b7280, #374151);
        }

        .story-main-title {
            font-size: 2.5em;
            font-weight: 900;
            color: #374151;
            margin-bottom: 12px;
            letter-spacing: -0.5px;
        }

        .story-subtitle {
            font-size: 1.2em;
            color: #64748b;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .story-level-badge {
            background: linear-gradient(135deg, #6b7280, #374151);
            color: white;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 700;
            display: inline-block;
            box-shadow: 0 4px 15px rgba(107, 114, 128, 0.3);
        }

        /* Back Button */
        .back-button {
            background: linear-gradient(135deg, #e5e7eb, #d1d5db);
            color: #374151;
            border: 2px solid #d1d5db;
            padding: 12px 25px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 30px;
            font-size: 1em;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .back-button:hover {
            background: linear-gradient(135deg, #d1d5db, #9ca3af);
            color: #1f2937;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        /* Chapter Navigation Redesign */
        .chapter-navigation {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 35px;
            margin-bottom: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border: 1px solid #f1f5f9;
        }

        .nav-title {
            font-size: 1.8em;
            font-weight: 800;
            color: #374151;
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .nav-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, #6b7280, #374151);
            border-radius: 2px;
        }

        .chapter-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .chapter-card {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            padding: 25px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .chapter-card:hover {
            transform: translateY(-6px) scale(1.02);
            box-shadow: 0 15px 35px rgba(0,0,0,0.12);
            border-color: #6b7280;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        }

        .chapter-card.active {
            background: linear-gradient(135deg, #6b7280, #374151);
            color: white;
            border-color: #6b7280;
            transform: translateY(-4px) scale(1.05);
            box-shadow: 0 12px 30px rgba(107, 114, 128, 0.4);
        }

        .chapter-card.completed {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border-color: #10b981;
        }

        .chapter-card .chapter-icon {
            font-size: 2.5em;
            margin-bottom: 12px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .chapter-card .chapter-number {
            font-size: 1.1em;
            font-weight: 800;
            margin-bottom: 8px;
            color: #374151;
        }

        .chapter-card.active .chapter-number,
        .chapter-card.completed .chapter-number {
            color: rgba(255,255,255,0.9);
        }

        .chapter-card .chapter-name {
            font-size: 0.9em;
            font-weight: 600;
            color: #64748b;
            line-height: 1.3;
        }

        .chapter-card.active .chapter-name,
        .chapter-card.completed .chapter-name {
            color: rgba(255,255,255,0.8);
        }

        .completion-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 32px;
            height: 32px;
            background: #10b981;
            border-radius: 50%;
            color: white;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            border: 3px solid white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }

        /* Chapter Container */
        .chapter-container {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border: 1px solid #f1f5f9;
            margin-bottom: 40px;
        }

        .chapter-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px solid #f1f5f9;
        }

        .chapter-title {
            font-size: 2.2em;
            font-weight: 900;
            color: #374151;
            margin-bottom: 15px;
            letter-spacing: -0.5px;
        }

        .chapter-number {
            background: linear-gradient(135deg, #6b7280, #374151);
            color: white;
            padding: 10px 25px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 1em;
            display: inline-block;
            box-shadow: 0 4px 15px rgba(107, 114, 128, 0.3);
        }

        /* Progress Section */
        .progress-section {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(5px);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 40px;
            border: 1px solid #e2e8f0;
        }

        .progress-bar {
            width: 100%;
            height: 14px;
            background: #e2e8f0;
            border-radius: 7px;
            overflow: hidden;
            margin-bottom: 25px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6b7280, #374151);
            width: 0%;
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 7px;
        }

        .badges {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .badge {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            padding: 12px 20px;
            font-size: 0.9em;
            font-weight: 600;
            color: #64748b;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .badge.earned {
            background: linear-gradient(135deg, #6b7280, #374151);
            color: white;
            border-color: #6b7280;
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(107, 114, 128, 0.3);
            animation: badgeEarn 0.8s ease-out;
        }

        @keyframes badgeEarn {
            0% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.2) rotate(5deg); }
            100% { transform: scale(1.05) rotate(0deg); }
        }

        /* Reading Section */
        .reading-section {
            margin-bottom: 50px;
        }

        .reading-title {
            font-size: 1.6em;
            font-weight: 800;
            color: #374151;
            text-align: center;
            margin-bottom: 30px;
        }

        .story-text {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 45px;
            margin-bottom: 30px;
            border: 2px solid #f1f5f9;
            box-shadow: 0 4px 20px rgba(0,0,0,0.03);
            line-height: 1.8;
            font-size: 1.1em;
            color: #374155;
            position: relative;
        }

        .story-text::before {
            content: '"';
            position: absolute;
            top: 15px;
            left: 25px;
            font-size: 4em;
            color: #e2e8f0;
            font-family: Georgia, serif;
            line-height: 1;
        }

        .story-text p {
            margin-bottom: 20px;
            text-align: justify;
            text-indent: 1.5em;
            position: relative;
            z-index: 1;
        }

        .story-text p:first-child {
            text-indent: 0;
            margin-top: 20px;
        }

        .reading-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        /* Questions Section */
        .questions-section {
            margin-top: 50px;
        }

        .question {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(5px);
            border: 2px solid #f1f5f9;
            border-radius: 20px;
            padding: 35px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.03);
            transition: all 0.3s ease;
        }

        .question:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.08);
            border-color: #e2e8f0;
            background: rgba(255, 255, 255, 1);
        }

        .question-type {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 800;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .question-type.grammar {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
        }

        .question-type.comprehension {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }

        .question-text {
            font-size: 1.3em;
            color: #374151;
            font-weight: 700;
            margin-bottom: 25px;
            line-height: 1.4;
        }

        .options {
            display: grid;
            gap: 15px;
        }

        .option {
            display: flex;
            align-items: center;
            padding: 20px 25px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .option::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(107, 114, 128, 0.05), transparent);
            transition: left 0.5s;
        }

        .option:hover::before {
            left: 100%;
        }

        .option:hover {
            border-color: #6b7280;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            transform: translateX(5px);
        }

        .option.selected {
            border-color: #374151;
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            transform: translateX(5px);
        }

        .option.correct-answer {
            background: linear-gradient(135deg, #dcfce7, #bbf7d0);
            border-color: #10b981;
            animation: correctPulse 1s ease-in-out;
        }

        .option.wrong-answer {
            background: linear-gradient(135deg, #fef2f2, #fecaca);
            border-color: #ef4444;
            animation: wrongShake 0.6s ease-in-out;
        }

        @keyframes correctPulse {
            0%, 100% { transform: translateX(5px); }
            50% { transform: translateX(8px) scale(1.02); box-shadow: 0 8px 25px rgba(16, 185, 129, 0.2); }
        }

        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .option input[type="radio"] {
            margin-right: 15px;
            transform: scale(1.3);
            accent-color: #6b7280;
        }

        .option label {
            font-weight: 600;
            font-size: 1.05em;
            cursor: pointer;
            flex: 1;
            color: #374155;
        }

        /* Controls */
        .controls {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 2px solid #f1f5f9;
            flex-wrap: wrap;
        }

        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 15px;
            font-weight: 700;
            cursor: pointer;
            font-size: 1.05em;
            transition: all 0.3s ease;
            text-transform: none;
            letter-spacing: 0.3px;
            position: relative;
            overflow: hidden;
            min-width: 160px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, #6b7280, #374151);
            color: white;
            box-shadow: 0 4px 15px rgba(107, 114, 128, 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #374151, #1f2937);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(107, 114, 128, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #e5e7eb, #d1d5db);
            color: #374151;
            border: 2px solid #d1d5db;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #d1d5db, #9ca3af);
            color: #1f2937;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        /* Score Section */
        .score {
            text-align: center;
            margin-top: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #6b7280, #374151);
            color: white;
            border-radius: 20px;
            font-size: 1.4em;
            font-weight: 800;
            box-shadow: 0 8px 30px rgba(107, 114, 128, 0.4);
            animation: scoreAppear 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes scoreAppear {
            from { opacity: 0; transform: translateY(20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* Feedback */
        .feedback {
            margin-top: 30px;
            animation: feedbackSlide 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes feedbackSlide {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Celebration Animations */
        .celebration-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            background: rgba(0, 0, 0, 0.1);
            z-index: 9999;
            pointer-events: none;
        }

        .celebration-text {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4em;
            font-weight: 900;
            background: linear-gradient(135deg, #6b7280, #374151);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            z-index: 10000;
            animation: celebrationPulse 2s ease-in-out;
            pointer-events: none;
        }

        @keyframes celebrationPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
        }

        .confetti, .firework {
            position: fixed;
            pointer-events: none;
            z-index: 9998;
        }

        .confetti {
            width: 10px; height: 10px;
            animation: confettiFall linear forwards;
        }

        @keyframes confettiFall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        .firework {
            width: 6px; height: 6px;
            border-radius: 50%;
            animation: fireworkExplode 1.5s ease-out forwards;
        }

        @keyframes fireworkExplode {
            0% { transform: scale(0); opacity: 1; }
            50% { transform: scale(15); opacity: 0.8; }
            100% { transform: scale(25); opacity: 0; }
        }

        /* Adicionar estilo para slideInUp que estava faltando */
        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .story-header {
                padding: 30px 20px;
            }

            .story-main-title {
                font-size: 2em;
            }

            .chapter-navigation {
                padding: 25px 20px;
            }

            .chapter-cards {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .chapter-card {
                padding: 20px 15px;
                min-height: 120px;
            }

            .chapter-card .chapter-icon {
                font-size: 2em;
            }

            .chapter-container {
                padding: 30px 20px;
            }

            .chapter-title {
                font-size: 1.8em;
            }

            .story-text {
                padding: 30px 25px;
                font-size: 1em;
            }

            .question {
                padding: 25px 20px;
            }

            .question-text {
                font-size: 1.2em;
            }

            .option {
                padding: 18px 20px;
            }

            .controls {
                flex-direction: column;
                align-items: center;
            }

            .btn {
                width: 100%;
                max-width: 280px;
            }

            .celebration-text {
                font-size: 2.5em;
            }

            .badges {
                gap: 10px;
            }

            .badge {
                padding: 10px 16px;
                font-size: 0.8em;
            }
        }

        @media (max-width: 480px) {
            .chapter-cards {
                grid-template-columns: 1fr;
            }

            .story-text {
                padding: 25px 20px;
            }

            .story-text p {
                text-indent: 0;
            }
        }
    </style>
</head>
<body class="neighbor-page">
    <!-- User Info -->
    <div style="position: fixed; top: 15px; right: 15px; z-index: 1000;">
        <div style="background: rgba(255,255,255,0.95); border-radius: 15px; padding: 8px 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); border: 2px solid #6b7280; backdrop-filter: blur(10px);">
            <span style="color: #374151; font-weight: 700; margin-right: 8px; font-size: 0.8em;">üëã <span id="userName">Aluno</span></span>
            <button onclick="logout()" style="background: #6b7280; color: white; border: none; padding: 5px 10px; border-radius: 8px; cursor: pointer; font-size: 0.75em; font-weight: 600; transition: all 0.3s ease;" onmouseover="this.style.background='#374151'" onmouseout="this.style.background='#6b7280'">üö™ Sair</button>
        </div>
    </div>
    
    <div class="container">
        <button class="back-button" onclick="goBackToHub()">
            ‚Üê Voltar ao Reading Hub
        </button>
        
        <div class="story-header">
            <div class="story-main-title">üì∫ The Perfect Neighbor</div>
            <div class="story-subtitle">Um thriller psicol√≥gico sobre obsess√£o e identidade</div>
            <div class="story-level-badge">üìñ N√≠vel A2 Low - Pure Reading</div>
        </div>
    
        <!-- NAVEGA√á√ÉO DE CAP√çTULOS -->
        <div class="chapter-navigation">
            <div class="nav-title">üìñ Escolha seu Cap√≠tulo</div>
            <div class="chapter-cards" id="chapterCards">
                <!-- Cards ser√£o gerados dinamicamente -->
            </div>
        </div>
        
        <div class="chapter-container" id="chapterContainer">
            <div class="chapter-header">
                <div class="chapter-title" id="chapterTitle">The New Neighbor</div>
                <div class="chapter-number" id="chapterNumber">Cap√≠tulo 1</div>
            </div>
            
            <div class="progress-section">
                <div class="progress-bar"><div class="progress-fill" id="progressBar"></div></div>
                
                <div class="badges">
                    <div class="badge" id="badge1">üìö Primeira Leitura</div>
                    <div class="badge" id="badge2">üéØ Boa Pontua√ß√£o</div>
                    <div class="badge" id="badge3">‚≠ê Cap√≠tulo Perfeito</div>
                    <div class="badge" id="badge4">üß† Mestre da Gram√°tica</div>
                    <div class="badge" id="badge5">üîç Leitor Atento</div>
                </div>
            </div>
            
            <div class="reading-section">
                <div class="reading-title" id="readingTitle">üìñ Leia o Cap√≠tulo: The New Neighbor</div>
                <div class="story-text" id="storyText">
                    <!-- Texto da hist√≥ria ser√° inserido aqui -->
                </div>
                <div class="reading-controls">
                    <button class="btn btn-primary" onclick="scrollToQuestions()">üìù Ir para Perguntas</button>
                    <button class="btn btn-secondary" onclick="scrollToTop()">‚¨ÜÔ∏è Voltar ao In√≠cio</button>
                </div>
            </div>
            
            <div class="questions-section" id="questionsContainer"></div>
            
            <div class="controls">
                <button class="btn btn-primary" onclick="checkAnswers()">‚úÖ Verificar Respostas</button>
                <button class="btn btn-secondary" onclick="resetQuiz()">üîÑ Reiniciar Cap√≠tulo</button>
                <button class="btn btn-primary" onclick="nextChapter()">‚û°Ô∏è Pr√≥ximo Cap√≠tulo</button>
            </div>
            
            <div id="scoreSection" class="score" style="display: none;">
                Sua Pontua√ß√£o: <span id="scoreValue">0</span>/5 üìö
            </div>
            
            <div id="feedback" class="feedback" style="display: none;"></div>
        </div>
    </div>
    
    <script>
        // ===== SISTEMA DE PROTE√á√ÉO DE LOGIN =====
        function checkLogin() {
            if (sessionStorage.getItem('studentLoggedIn') !== 'true') {
                window.location.href = 'login.html';
                return false;
            }
            return true;
        }

        function logout() {
            sessionStorage.removeItem('studentLoggedIn');
            sessionStorage.removeItem('studentUsername');
            window.location.href = 'login.html';
        }

        function getStudentName() {
            return sessionStorage.getItem('studentUsername') || 'Student';
        }

        function goBackToHub() {
            window.location.href = 'pure-reading-a2-low.html';
        }

        if (!checkLogin()) throw new Error('Not logged in');

        // ===== SISTEMA DE PROGRESSO =====
        class StudentProgress {
            constructor() {
                this.studentId = sessionStorage.getItem('studentUsername') || 'student';
                this.progressKey = `progress_${this.studentId}`;
                this.loadProgress();
            }

            loadProgress() {
                const saved = localStorage.getItem(this.progressKey);
                if (saved) {
                    this.data = JSON.parse(saved);
                } else {
                    this.data = {
                        listening: { lessonsCompleted: [], bestScores: {}, totalAttempts: 0, badges: [] },
                        reading: { chaptersCompleted: [], bestScores: {}, totalAttempts: 0, badges: [] },
                        roommate: { chaptersCompleted: [], bestScores: {}, totalAttempts: 0, badges: [] },
                        neighbor: { chaptersCompleted: [], bestScores: {}, totalAttempts: 0, badges: [] },
                        globalBadges: [], lastActivity: null, joinDate: new Date().toISOString(), totalStudyTime: 0
                    };
                }
                if (!this.data.neighbor) {
                    this.data.neighbor = { chaptersCompleted: [], bestScores: {}, totalAttempts: 0, badges: [] };
                }
            }

            saveProgress() { 
                localStorage.setItem(this.progressKey, JSON.stringify(this.data));
                console.log(`üíæ Progresso salvo para ${this.studentId}`);
            }

            completeNeighborChapter(chapterNumber, score, timeSpent) {
                const chapter = `chapter_${chapterNumber}`;
                if (!this.data.neighbor.chaptersCompleted.includes(chapter)) {
                    this.data.neighbor.chaptersCompleted.push(chapter);
                }
                if (!this.data.neighbor.bestScores[chapter] || score > this.data.neighbor.bestScores[chapter]) {
                    this.data.neighbor.bestScores[chapter] = score;
                }
                this.data.neighbor.totalAttempts++;
                this.data.totalStudyTime += timeSpent;
                this.data.lastActivity = new Date().toISOString();
                this.checkNeighborBadges(chapterNumber, score);
                this.saveProgress();
                this.updateChapterCards();
            }

            checkNeighborBadges(chapterNumber, score) {
                const badges = this.data.neighbor.badges;
                if (!badges.includes('first_chapter')) {
                    badges.push('first_chapter');
                    this.showBadgeNotification('üìö Primeira Leitura!', 'Voc√™ come√ßou a leitura pura!');
                }
                if (score === 5 && !badges.includes('perfect_chapter')) {
                    badges.push('perfect_chapter');
                    this.showBadgeNotification('‚≠ê Cap√≠tulo Perfeito!', 'Voc√™ entendeu perfeitamente a hist√≥ria!');
                }
                if (this.data.neighbor.chaptersCompleted.length >= 5 && !badges.includes('complete_story')) {
                    badges.push('complete_story');
                    this.showBadgeNotification('üéâ Hist√≥ria Completa!', 'Voc√™ terminou The Perfect Neighbor!');
                }
                if (score >= 4 && !badges.includes('grammar_master')) {
                    badges.push('grammar_master');
                    this.showBadgeNotification('üß† Mestre da Gram√°tica!', 'Excelente conhecimento gramatical!');
                }
            }

            showBadgeNotification(title, message) {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                    background: linear-gradient(135deg, #6b7280, #374151); color: white;
                    padding: 25px 35px; border-radius: 20px; z-index: 10000; text-align: center;
                    box-shadow: 0 15px 40px rgba(0,0,0,0.3); backdrop-filter: blur(10px);
                `;
                notification.innerHTML = `<div style="font-size: 1.8em; font-weight: bold; margin-bottom: 15px;">${title}</div><div style="font-size: 1.1em;">${message}</div>`;
                document.body.appendChild(notification);
                setTimeout(() => { if (document.body.contains(notification)) document.body.removeChild(notification); }, 3000);
            }

            updateChapterCards() {
                createChapterCards();
            }
        }

        // ===== SISTEMA DE CAP√çTULOS =====
        const chapters = {
            1: { 
                title: "The New Neighbor", 
                shortTitle: "New Neighbor", 
                icon: "üëã", 
                story: `Paula lives in a quiet street with her husband Carlos. They are happy together for five years. Carlos works at a bank. Paula is a teacher.

One morning, Paula sees a moving truck. Someone new is moving to the house next door.

"Carlos, we have a new neighbor!" Paula says.

"That's nice," Carlos says, drinking his coffee.

A beautiful woman comes out of the house. She has long blonde hair and expensive clothes. She sees Paula and smiles.

"Hello!" the woman calls. "I'm Helena. I'm your new neighbor!"

Paula walks over. "Hi! I'm Paula. Welcome to the neighborhood!"

Helena looks at Paula very carefully. Her eyes study Paula's hair, her dress, her shoes.

"You have beautiful hair," Helena says. "What salon do you go to?"

"Oh, just Salon Maria on Main Street," Paula answers.

"And your dress! So pretty! Where did you buy it?"

"The mall. Nothing special," Paula laughs.

Helena keeps asking questions. About Paula's job, her schedule, her favorite places. Paula thinks Helena is just being friendly.

"Would you like coffee tomorrow morning?" Helena asks.

"Sure! I'd love that," Paula says.

That night, Paula tells Carlos about Helena.

"She seems very nice," Paula says. "But she asked so many questions!"

"New neighbors always do that," Carlos says. "They want to know about the area."

Paula nods. But something feels strange. Helena's questions were not about the neighborhood. They were all about Paula.

The next morning, Paula looks out her window. Helena is in her garden, but she's not gardening. She's watching Paula's house.

When Helena sees Paula, she waves and smiles. "Ready for coffee?"

Paula feels uncomfortable, but she goes anyway. Helena's house is beautiful inside. Very expensive furniture. Very clean.

"You have a lovely home," Paula says.

"Thank you. I want everything to be perfect," Helena says. Her eyes are very bright. Too bright.

They drink coffee and talk. But Helena keeps staring at Paula. Studying her.

"I hope we can be best friends," Helena says suddenly.

Paula smiles politely. But inside, she feels worried. There's something wrong with her perfect neighbor.`, 
                questions: { 
                    q1: { type: "comprehension", text: "How long have Paula and Carlos been together?", options: ["Three years", "Five years", "Ten years", "Two years"], correct: "b" }, 
                    q2: { type: "comprehension", text: "What does Helena look like?", options: ["Short dark hair", "Long blonde hair", "Red hair", "Curly brown hair"], correct: "b" }, 
                    q3: { type: "comprehension", text: "What makes Paula feel uncomfortable?", options: ["Helena's expensive clothes", "Helena asking too many questions", "Helena's beautiful house", "Helena's garden"], correct: "b" }, 
                    q4: { type: "grammar", text: 'Complete: "Paula _____ in a quiet street."', options: ["live", "lives", "living", "lived"], correct: "b" }, 
                    q5: { type: "grammar", text: "Which sentence is correct?", options: ["They are happy together for five years.", "They is happy together for five years.", "They am happy together for five years.", "They was happy together for five years."], correct: "a" } 
                } 
            },
            2: { 
                title: "Strange Things", 
                shortTitle: "Strange Things", 
                icon: "üëÅÔ∏è", 
                story: `Three weeks pass. Helena visits Paula every day. She always wants to know Paula's plans.

"What are you doing today?" Helena asks every morning.

"Going to the market," Paula says.

Two hours later, Paula sees Helena at the same market. This happens many times.

Paula goes to the pharmacy. Helena is there.

Paula goes to the coffee shop. Helena appears.

Paula visits her mother. Helena is on the same street.

"This is very strange," Paula tells her friend Lisa. "My neighbor is always in the same places as me."

"Maybe it's just coincidence," Lisa says.

But Paula doesn't think so. Something else is bothering her. Helena is changing.

When they first met, Helena wore expensive designer clothes. Now she wears simple dresses. Like Paula's dresses.

Helena had long blonde hair. Last week, she cut it short and dyed it brown. Like Paula's hair.

Helena bought the same car as Paula. The same color.

"Carlos, don't you think this is weird?" Paula asks her husband.

"What's weird?" Carlos is watching TV.

"Helena! She's copying everything I do!"

Carlos laughs. "Paula, you're being paranoid. She just has similar taste."

But Paula knows it's more than that. Yesterday, she saw Helena talking to Carlos when he came home from work.

"What did Helena want?" Paula asked.

"She was just being friendly. She asked about my job, my schedule. Nice woman," Carlos said.

Paula felt angry. Why was Helena asking about Carlos's schedule?

That evening, Paula decides to test something. She tells Helena a lie.

"I'm going to change my hair color," Paula says. "I want to try blonde."

Helena's eyes get very bright. "Blonde? Really? When?"

"Next week," Paula lies.

Three days later, Paula sees Helena coming out of Salon Maria. Her hair is now blonde. Exactly like Paula described.

Paula feels scared now. This is not normal. Helena is not just copying her style. Helena wants to BE her.

Paula calls Lisa. "Something is very wrong with my neighbor."

"What do you mean?" Lisa asks.

"She's trying to become me! Same hair, same clothes, same places. Lisa, I think she wants my life!"

"That's crazy, Paula."

"Is it? What if she wants my husband too?"

Lisa is quiet. Then she says, "Paula, you need to be careful."

That night, Paula locks all her doors. She closes all her curtains. But she can feel Helena watching her house.

In her perfect neighbor's perfect window.`, 
                questions: { 
                    q1: { type: "comprehension", text: "How often does Helena visit Paula?", options: ["Once a week", "Every day", "Never", "Twice a week"], correct: "b" }, 
                    q2: { type: "comprehension", text: "What does Helena change about herself?", options: ["Her clothes and hair", "Her house", "Her car only", "Her job"], correct: "a" }, 
                    q3: { type: "comprehension", text: "How does Paula test Helena?", options: ["She tells her a lie about changing her hair", "She follows her", "She asks Carlos to help", "She calls the police"], correct: "a" }, 
                    q4: { type: "grammar", text: 'Complete: "Helena _____ visits Paula every day."', options: ["always", "never", "sometimes", "rarely"], correct: "a" }, 
                    q5: { type: "grammar", text: "Which sentence uses past tense correctly?", options: ["She cut it short and dyed it brown.", "She cuts it short and dies it brown.", "She cutting it short and dying it brown.", "She cuts it short and dyed it brown."], correct: "a" } 
                } 
            },
            3: { 
                title: "The Obsession", 
                shortTitle: "The Obsession", 
                icon: "üí≠", 
                story: `Paula's worst fears come true. Helena is now identical to her. Same hair, same makeup, same clothes. When they walk down the street together, people think they are sisters.

But Helena wants more.

Paula finds Helena in her garden, talking to Carlos again.

"Helena was just asking about our anniversary," Carlos explains. "She wants to know how we met."

"Why does she want to know that?" Paula asks.

"She's interested in love stories," Carlos says. "She's very romantic."

Paula feels sick. Helena is studying her marriage now.

The next week, Paula sees Helena at the flower shop. She's buying the same flowers that Carlos buys for Paula every Friday.

Paula follows Helena to a restaurant. Helena is there alone, but she orders Paula's favorite meal. She practices eating like Paula eats.

"This woman is completely insane!" Paula tells Lisa.

"Have you talked to Carlos about this?"

"He thinks I'm being dramatic. He says Helena is just lonely and wants friends."

But Paula knows the truth. Helena doesn't want to be Paula's friend. Helena wants to BE Paula.

Paula decides to search for information about Helena. She goes to the post office.

"Excuse me," Paula asks the worker. "My neighbor Helena Santos... has she lived here long?"

The worker checks the computer. "Helena Santos? No one with that name receives mail here."

"But she lives next door to me!"

"The house next door? That's registered to someone else. A man named Roberto Silva."

Paula feels confused. "But Helena said she bought the house..."

"Roberto Silva bought it six months ago. He doesn't live there. He rents it to someone, but not Helena Santos."

Paula's hands start shaking. Helena lied about her name. She lied about everything.

Paula goes home and calls the rental agency.

"I'd like information about the renter at 245 Rose Street," Paula says.

"I can't give personal information," the woman says.

"Please! She's my neighbor. I think she's dangerous!"

The woman is quiet. Then she whispers, "Have you had problems with her?"

"Yes! Why?"

"We've had three complaints about that tenant. She... she copies other tenants. Follows them. The last tenant moved away because of her."

Paula drops the phone. Helena has done this before. To other women. Other lives.

And now Helena wants Paula's life. Paula's husband. Paula's everything.

That evening, Paula watches from her window. Helena is in her garden, but she's not alone. Carlos is there. They're talking very close together. Too close.

Helena touches Carlos's arm. She laughs at something he says. She looks at him the way Paula looks at him.

"No," Paula whispers. "You will not take my husband. You will not take my life!"

But how can she stop someone who is becoming her exact copy?`, 
                questions: { 
                    q1: { type: "comprehension", text: "What does Helena ask Carlos about?", options: ["His job", "His anniversary and love story", "His family", "His hobbies"], correct: "b" }, 
                    q2: { type: "comprehension", text: "What does Paula discover at the post office?", options: ["Helena uses a fake name", "Helena is married", "Helena has money problems", "Helena is rich"], correct: "a" }, 
                    q3: { type: "comprehension", text: "How many complaints has the rental agency received about Helena?", options: ["One", "Two", "Three", "Four"], correct: "c" }, 
                    q4: { type: "grammar", text: 'Complete: "Helena _____ more."', options: ["want", "wants", "wanting", "wanted"], correct: "b" }, 
                    q5: { type: "grammar", text: "Which sentence is in present perfect?", options: ["We had three complaints.", "We have had three complaints.", "We are having three complaints.", "We will have three complaints."], correct: "b" } 
                } 
            },
            4: { 
                title: "The Confrontation", 
                shortTitle: "Confrontation", 
                icon: "‚ö°", 
                story: `Paula cannot sleep. She watches Helena's house all night. In the morning, she sees something that makes her blood freeze.

Helena comes out of her house wearing Paula's exact outfit. The dress Paula planned to wear today. But Paula never told Helena about this dress.

Helena has been in Paula's house. In Paula's closet.

Paula runs to check her spare key. It's gone.

"That's it!" Paula screams. "This ends today!"

Paula marches to Helena's house and pounds on the door.

"Helena! Open this door now!"

Helena opens the door, smiling sweetly. "Good morning, Paula! Don't you love this dress? We have such similar taste!"

"You stole my key! You were in my house!" Paula shouts.

"What are you talking about?" Helena asks innocently.

"Stop pretending! I know what you're doing! You're copying my life! You want to steal my husband!"

Helena's sweet smile disappears. Her eyes become cold and dangerous.

"Steal?" Helena laughs. "I don't need to steal anything. Carlos is already falling in love with me."

Paula feels like someone hit her. "What?"

"Men are so simple," Helena says. "I look like you, but I'm more interesting. More mysterious. Carlos tells me things he doesn't tell you."

"You're lying!"

"Am I? He told me your marriage is boring. He said you never surprise him anymore. But I... I surprise him every day."

Paula wants to hit Helena, but she controls herself. "Carlos loves me!"

"Does he? When was the last time he brought you flowers without you asking? When was the last time he looked at you the way he looks at me?"

Paula's heart breaks because Helena is right. Carlos has been distant lately.

"You manipulated him!" Paula cries.

"I gave him what you stopped giving him. Attention. Excitement. A woman who listens."

"I listen to him!"

"No, you complain. About work, about money, about everything. I never complain. I'm perfect."

Helena steps closer. "Face the truth, Paula. I'm a better version of you. Younger, prettier, more interesting. Carlos deserves better than a boring wife."

"He's MY husband!"

"Not for long," Helena says. "Tonight, Carlos is taking me to dinner. He's going to tell you about us. He's going to ask for a divorce."

Paula feels the world spinning. "No... no, he wouldn't..."

"Check his phone," Helena suggests. "Read our messages. See how happy I make him."

Paula runs home. With shaking hands, she picks up Carlos's phone. It's unlocked.

Messages between Carlos and Helena:
"Thank you for listening to me."
"You understand me like Paula never did."
"I've never felt this way before."
"Tonight we need to talk about our future."

Paula drops the phone and starts crying. Her perfect marriage is destroyed. Her perfect neighbor has won.

But then Paula gets angry. Very angry.

"No," she says through her tears. "I will not let this woman destroy my life. I will fight!"`, 
                questions: { 
                    q1: { type: "comprehension", text: "How does Paula know Helena was in her house?", options: ["Helena is wearing Paula's exact outfit", "Things are missing", "A neighbor saw her", "Carlos told her"], correct: "a" }, 
                    q2: { type: "comprehension", text: "What does Helena say about Carlos?", options: ["He's not interested in her", "He's falling in love with her", "He wants to move away", "He's afraid of her"], correct: "b" }, 
                    q3: { type: "comprehension", text: "What does Paula find on Carlos's phone?", options: ["Photos", "Messages between Carlos and Helena", "Nothing suspicious", "Games"], correct: "b" }, 
                    q4: { type: "grammar", text: 'Complete: "Helena _____ been in Paula\'s house."', options: ["has", "have", "had", "having"], correct: "a" }, 
                    q5: { type: "grammar", text: "Which sentence uses the correct comparative?", options: ["I'm more interesting.", "I'm most interesting.", "I'm interestinger.", "I'm very interesting."], correct: "a" } 
                } 
            },
            5: { 
                title: "The Truth Revealed", 
                shortTitle: "Truth Revealed", 
                icon: "üö®", 
                story: `Paula calls her friend Lisa. "I need your help. Tonight, Carlos is meeting Helena. I need to prove she's dangerous."

"What's your plan?"

"I'm going to follow them. And I need you to call the police if something happens."

That evening, Carlos gets dressed nicely. "I'm going out with some friends," he lies.

"Have fun," Paula says, pretending she doesn't know.

Paula follows Carlos to the restaurant. She sits where she can see their table. Carlos looks nervous. Helena looks beautiful and confident.

Paula can't hear their conversation, but she can see Helena touching Carlos's hand. Carlos looks confused and sad.

Then Paula remembers something. The rental agency said they had Helena's phone number. Paula calls them.

"This is an emergency," Paula says. "I need that woman's real information. She's dangerous!"

"Her real name is Elena Rojas," the woman whispers. "She has a criminal record. Stalking. Identity theft. She does this to married couples."

Paula's blood freezes. "Married couples?"

"She destroys marriages, steals the husband, then disappears with their money. She's done it five times."

Paula hangs up and calls the police immediately.

"My neighbor is a criminal! She's with my husband right now!"

While Paula waits for the police, she sees Helena and Carlos leaving the restaurant. Helena is pulling Carlos toward her car.

Paula follows them to Helena's house. Through the window, she can see Helena giving Carlos wine. Too much wine. Carlos looks dizzy.

"She's drugging him!" Paula realizes.

Paula calls the police again. "Hurry! She's drugging my husband!"

Paula can't wait. She breaks Helena's back door and runs inside.

"Get away from my husband!" Paula screams.

Helena spins around. Her sweet mask is gone. She looks crazy now.

"You ruined everything!" Helena shouts. "He was ready to leave you!"

"Carlos!" Paula shakes her husband. "Carlos, wake up!"

Carlos opens his eyes slowly. "Paula? What... where am I?"

"Elena drugged you!" Paula says.

"Elena? Who's Elena?" Carlos looks confused.

"Your perfect neighbor! Her real name is Elena Rojas! She's a criminal!"

The police arrive. They arrest Helena/Elena. In her house, they find photos of Paula, copies of Paula's documents, and drugs.

"She was planning to steal your identity," the detective explains. "And probably your husband's money too."

Carlos holds Paula tightly. "I'm so sorry. She made me feel... I don't know how to explain it."

"She manipulated you," Paula says. "She's an expert."

The detective continues, "Elena drugs men to make them confused and emotional. Then she convinces them to leave their wives and give her access to their bank accounts."

"But I never gave her money," Carlos says.

"Not yet. But she was working on it. We found papers. She was planning to convince you to invest in a fake business with her."

Carlos looks sick. "Paula, I almost destroyed our marriage for a criminal."

"She's very good at what she does," the detective says. "You're lucky your wife discovered the truth."

Elena is taken away in handcuffs. As she passes Paula, she hisses, "This isn't over."

"Yes, it is," Paula says firmly.

One month later, Paula and Carlos are in therapy, working on their marriage. They're stronger now.

"I learned something," Carlos says. "I was taking you for granted. I forgot how special you are."

"And I learned to trust my instincts," Paula says. "When something feels wrong, it probably is."

They look at Helena's old house. A new family is moving in. A normal family.

"No more perfect neighbors," Carlos jokes.

"No," Paula agrees. "Perfect is always suspicious."

They laugh and go inside their house. Their real, imperfect, honest house.

Because sometimes, the perfect neighbor is perfectly dangerous.`, 
                questions: { 
                    q1: { type: "comprehension", text: "What is Helena's real name?", options: ["Elena Santos", "Elena Rojas", "Elena Silva", "Elena Martinez"], correct: "b" }, 
                    q2: { type: "comprehension", text: "How many times has Elena done this before?", options: ["Three times", "Five times", "Seven times", "Two times"], correct: "b" }, 
                    q3: { type: "comprehension", text: "What was Elena's final plan?", options: ["To steal Paula's identity and Carlos's money", "To move away", "To become Paula's best friend", "To buy a new house"], correct: "a" }, 
                    q4: { type: "grammar", text: 'Complete: "Elena _____ men to make them confused."', options: ["drug", "drugs", "drugging", "drugged"], correct: "b" }, 
                    q5: { type: "grammar", text: "Which sentence is in past continuous?", options: ["She planned to steal your identity.", "She was planning to steal your identity.", "She plans to steal your identity.", "She will plan to steal your identity."], correct: "b" } 
                } 
            }
        };
        
        let currentChapter = 1, attempts = 0, chapterStartTime = Date.now(), studentProgress = new StudentProgress();
        
        // ===== NAVEGA√á√ÉO DE CAP√çTULOS =====
        function createChapterCards() {
            const cardsContainer = document.getElementById('chapterCards');
            cardsContainer.innerHTML = '';
            
            for (let i = 1; i <= 5; i++) {
                const chapter = chapters[i];
                const isCompleted = studentProgress.data.neighbor.chaptersCompleted.includes(`chapter_${i}`);
                const bestScore = studentProgress.data.neighbor.bestScores[`chapter_${i}`] || 0;
                const isActive = i === currentChapter;
                
                const card = document.createElement('div');
                card.className = `chapter-card ${isActive ? 'active' : ''} ${isCompleted ? 'completed' : ''}`;
                card.onclick = () => switchToChapter(i);
                
                card.innerHTML = `
                    <div class="chapter-icon">${chapter.icon}</div>
                    <div class="chapter-number">Cap√≠tulo ${i}</div>
                    <div class="chapter-name">${chapter.shortTitle}</div>
                    ${isCompleted ? `<div class="completion-badge">${bestScore}</div>` : ''}
                `;
                
                cardsContainer.appendChild(card);
            }
        }
        
        function switchToChapter(chapterNumber) {
            if (chapterNumber === currentChapter) return;
            
            currentChapter = chapterNumber;
            loadChapter(currentChapter);
            createChapterCards();
            
            const container = document.getElementById('chapterContainer');
            container.style.animation = 'none';
            container.offsetHeight;
            container.style.animation = 'slideInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
        }
        
        // ===== CARREGAR CAP√çTULO =====
        function loadChapter(chapterNumber) {
            if (!chapters[chapterNumber]) return;
            const chapter = chapters[chapterNumber];
            document.getElementById('chapterTitle').textContent = chapter.title;
            document.getElementById('chapterNumber').textContent = `Cap√≠tulo ${chapterNumber}`;
            document.getElementById('readingTitle').textContent = `üìñ Leia o Cap√≠tulo: ${chapter.title}`;
            
            // Formatar o texto em par√°grafos
            const formattedStory = chapter.story
                .split('\n\n')
                .map(paragraph => paragraph.trim())
                .filter(paragraph => paragraph.length > 0)
                .map(paragraph => `<p>${paragraph}</p>`)
                .join('');
            
            document.getElementById('storyText').innerHTML = formattedStory;
            loadQuestions(chapter.questions);
            resetQuiz();
        }
        
        function loadQuestions(questions) {
            const container = document.getElementById('questionsContainer');
            container.innerHTML = '';
            Object.keys(questions).forEach((key, index) => {
                const q = questions[key];
                const div = document.createElement('div');
                div.className = 'question';
                div.innerHTML = `
                    <div class="question-type ${q.type === 'grammar' ? 'grammar' : 'comprehension'}">${q.type === 'grammar' ? 'GRAM√ÅTICA' : 'INTERPRETA√á√ÉO'}</div>
                    <div class="question-text">${index + 1}. ${q.text}</div>
                    <div class="options">
                        ${q.options.map((opt, i) => `
                            <div class="option" data-value="${String.fromCharCode(97 + i)}">
                                <input type="radio" name="${key}" value="${String.fromCharCode(97 + i)}" id="${key}_${i}">
                                <label for="${key}_${i}">${String.fromCharCode(97 + i).toUpperCase()}) ${opt}</label>
                            </div>
                        `).join('')}
                    </div>
                `;
                container.appendChild(div);
            });
            addOptionEventListeners();
        }
        
        function addOptionEventListeners() {
            document.querySelectorAll('.option').forEach(option => {
                option.addEventListener('click', function() {
                    const radio = this.querySelector('input[type="radio"]');
                    radio.checked = true;
                    const name = radio.name;
                    document.querySelectorAll(`input[name="${name}"]`).forEach(opt => {
                        opt.closest('.option').classList.remove('selected');
                    });
                    this.classList.add('selected');
                });
            });
        }
        
        // ===== FUN√á√ïES DE NAVEGA√á√ÉO =====
        function scrollToQuestions() {
            document.getElementById('questionsContainer').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        }
        
        function scrollToTop() {
            window.scrollTo({ 
                top: 0, 
                behavior: 'smooth' 
            });
        }
        
        // ===== ANIMA√á√ïES DE CELEBRA√á√ÉO =====
        function createCelebration(score) {
            const overlay = document.createElement('div');
            overlay.className = 'celebration-overlay';
            document.body.appendChild(overlay);
            
            const celebrationText = document.createElement('div');
            celebrationText.className = 'celebration-text';
            
            if (score === 5) {
                celebrationText.textContent = 'PERFECT! üìö‚ú®';
                createConfetti();
            } else if (score === 4) {
                celebrationText.textContent = 'EXCELLENT! ‚≠êüéØ';
                createFireworks();
            }
            
            document.body.appendChild(celebrationText);
            
            setTimeout(() => {
                if (document.body.contains(overlay)) document.body.removeChild(overlay);
                if (document.body.contains(celebrationText)) document.body.removeChild(celebrationText);
            }, 3000);
        }
        
        function createConfetti() {
            const colors = ['#6b7280', '#374151', '#fbbf24', '#10b981', '#3b82f6'];
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0%';
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => {
                        if (document.body.contains(confetti)) document.body.removeChild(confetti);
                    }, 4000);
                }, i * 50);
            }
        }
        
        function createFireworks() {
            const colors = ['#fbbf24', '#ef4444', '#10b981', '#3b82f6'];
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const firework = document.createElement('div');
                    firework.className = 'firework';
                    firework.style.left = (Math.random() * 80 + 10) + 'vw';
                    firework.style.top = (Math.random() * 60 + 20) + 'vh';
                    firework.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    firework.style.animationDelay = Math.random() * 0.5 + 's';
                    document.body.appendChild(firework);
                    
                    setTimeout(() => {
                        if (document.body.contains(firework)) document.body.removeChild(firework);
                    }, 2000);
                }, i * 100);
            }
        }
        
        // ===== VERIFICAR RESPOSTAS =====
        function checkAnswers() {
            const chapter = chapters[currentChapter];
            const questions = Object.keys(chapter.questions);
            let score = 0;
            let detailedResults = [];
            let grammarScore = 0;
            let comprehensionScore = 0;
            attempts++;
            
            questions.forEach((key, index) => {
                const selected = document.querySelector(`input[name="${key}"]:checked`);
                const correct = chapter.questions[key].correct;
                const allOptions = document.querySelectorAll(`input[name="${key}"]`);
                const questionType = chapter.questions[key].type;
                const isGrammar = questionType === 'grammar';
                
                allOptions.forEach(opt => {
                    opt.closest('.option').classList.remove('correct-answer', 'wrong-answer');
                });
                
                const correctOption = document.querySelector(`input[name="${key}"][value="${correct}"]`);
                correctOption.closest('.option').classList.add('correct-answer');
                
                if (selected && selected.value !== correct) {
                    selected.closest('.option').classList.add('wrong-answer');
                }
                
                const correctOptionText = chapter.questions[key].options[correct.charCodeAt(0) - 97];
                const selectedOptionText = selected ? chapter.questions[key].options[selected.value.charCodeAt(0) - 97] : "N√£o respondida";
                
                let resultHTML = '';
                
                if (selected && selected.value === correct) {
                    score++;
                    if (isGrammar) grammarScore++;
                    else comprehensionScore++;
                    
                    const iconType = isGrammar ? 'üß†' : 'üìñ';
                    const typeLabel = isGrammar ? 'GRAM√ÅTICA' : 'INTERPRETA√á√ÉO';
                    
                    resultHTML = `
                        <div style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(16, 185, 129, 0.1)); border-left: 5px solid #10b981; padding: 25px; border-radius: 15px; margin-bottom: 20px; border: 2px solid rgba(16, 185, 129, 0.2);">
                            <div style="font-weight: 800; color: #059669; margin-bottom: 12px; font-size: 1.2em;">
                                ‚úÖ Quest√£o ${index + 1} (${typeLabel}) ${iconType}: CORRETO! üéØ
                            </div>
                            <div style="color: #047857; font-size: 1.05em; line-height: 1.6;">
                                <strong>Pergunta:</strong> ${chapter.questions[key].text}<br>
                                <strong>Sua resposta:</strong> <span style="background: rgba(34, 197, 94, 0.2); padding: 6px 12px; border-radius: 8px; font-weight: 700;">${selectedOptionText}</span> 
                                <span style="color: #10b981; font-size: 1.3em;">‚ú®</span>
                            </div>
                        </div>
                    `;
                } else {
                    const iconType = isGrammar ? 'üß†' : 'üìñ';
                    const typeLabel = isGrammar ? 'GRAM√ÅTICA' : 'INTERPRETA√á√ÉO';
                    
                    resultHTML = `
                        <div style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.1)); border-left: 5px solid #ef4444; padding: 25px; border-radius: 15px; margin-bottom: 20px; border: 2px solid rgba(239, 68, 68, 0.2);">
                            <div style="font-weight: 800; color: #dc2626; margin-bottom: 12px; font-size: 1.2em;">
                                ‚ùå Quest√£o ${index + 1} (${typeLabel}) ${iconType}: INCORRETO 
                            </div>
                            <div style="color: #991b1b; font-size: 1.05em; line-height: 1.6;">
                                <strong>Pergunta:</strong> ${chapter.questions[key].text}<br>
                                <strong>Sua resposta:</strong> <span style="background: rgba(239, 68, 68, 0.2); padding: 6px 12px; border-radius: 8px; font-weight: 600;">${selectedOptionText}</span><br>
                                <strong>Resposta correta:</strong> <span style="background: linear-gradient(135deg, #fbbf24, #f59e0b); color: white; padding: 6px 14px; border-radius: 10px; font-weight: 700; margin-top: 8px; display: inline-block;">${correctOptionText}</span>
                            </div>
                        </div>
                    `;
                }
                
                detailedResults.push(resultHTML);
            });
            
            studentProgress.completeNeighborChapter(currentChapter, score, Date.now() - chapterStartTime);
            
            document.getElementById('progressBar').style.width = (score / 5) * 100 + '%';
            document.getElementById('scoreValue').textContent = score;
            document.getElementById('scoreSection').style.display = 'block';
            
            if (attempts === 1) document.getElementById('badge1').classList.add('earned');
            if (score >= 4) document.getElementById('badge2').classList.add('earned');
            if (score === 5) document.getElementById('badge3').classList.add('earned');
            if (grammarScore >= 2) document.getElementById('badge4').classList.add('earned');
            if (comprehensionScore >= 3) document.getElementById('badge5').classList.add('earned');
            
            if (score === 5 || score === 4) {
                setTimeout(() => createCelebration(score), 500);
            }
            
            const feedback = document.getElementById('feedback');
            
            let feedbackHeader = '';
            if (score === 5) {
                feedbackHeader = `
                    <div style="text-align: center; background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 30px; border-radius: 20px; margin-bottom: 30px; font-size: 1.4em; font-weight: 800; box-shadow: 0 12px 35px rgba(16, 185, 129, 0.4);">
                        üéâ CAP√çTULO PERFEITO! üìö‚ú®<br>
                        <span style="font-size: 0.75em; opacity: 0.9; font-weight: 600;">Voc√™ entendeu perfeitamente a hist√≥ria!</span>
                    </div>
                `;
            } else if (score === 4) {
                feedbackHeader = `
                    <div style="text-align: center; background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; padding: 30px; border-radius: 20px; margin-bottom: 30px; font-size: 1.4em; font-weight: 800; box-shadow: 0 12px 35px rgba(59, 130, 246, 0.4);">
                        ‚≠ê EXCELENTE LEITURA! üéØ<br>
                        <span style="font-size: 0.75em; opacity: 0.9; font-weight: 600;">Quase perfeito! Continue assim!</span>
                    </div>
                `;
            } else if (score === 3) {
                feedbackHeader = `
                    <div style="text-align: center; background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 30px; border-radius: 20px; margin-bottom: 30px; font-size: 1.3em; font-weight: 800; box-shadow: 0 12px 35px rgba(245, 158, 11, 0.4);">
                        üëç BOM TRABALHO! üí™<br>
                        <span style="font-size: 0.75em; opacity: 0.9; font-weight: 600;">Continue lendo e praticando!</span>
                    </div>
                `;
            } else {
                feedbackHeader = `
                    <div style="text-align: center; background: linear-gradient(135deg, #ef4444, #dc2626); color: white; padding: 30px; border-radius: 20px; margin-bottom: 30px; font-size: 1.3em; font-weight: 800; box-shadow: 0 12px 35px rgba(239, 68, 68, 0.4);">
                        üí™ CONTINUE TENTANDO! üìñ<br>
                        <span style="font-size: 0.75em; opacity: 0.9; font-weight: 600;">Releia cuidadosamente e tente novamente!</span>
                    </div>
                `;
            }
            
            const statsHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <div style="background: rgba(59, 130, 246, 0.1); border: 2px solid #3b82f6; border-radius: 15px; padding: 25px; text-align: center;">
                        <div style="font-size: 1.8em; font-weight: 800; color: #1d4ed8;">üìñ ${comprehensionScore}/3</div>
                        <div style="color: #1e40af; font-weight: 700; font-size: 1.1em;">Interpreta√ß√£o</div>
                    </div>
                    <div style="background: rgba(168, 85, 247, 0.1); border: 2px solid #a855f7; border-radius: 15px; padding: 25px; text-align: center;">
                        <div style="font-size: 1.8em; font-weight: 800; color: #7c3aed;">üß† ${grammarScore}/2</div>
                        <div style="color: #6d28d9; font-weight: 700; font-size: 1.1em;">Gram√°tica</div>
                    </div>
                </div>
            `;
            
            feedback.innerHTML = feedbackHeader + statsHTML + detailedResults.join('');
            feedback.style.display = 'block';
            
            // Scroll para ver o resultado
            setTimeout(() => {
                document.getElementById('scoreSection').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center' 
                });
            }, 600);
        }
        
        function resetQuiz() {
            document.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.checked = false;
                const option = radio.closest('.option');
                option.classList.remove('selected', 'correct-answer', 'wrong-answer');
            });
            
            document.getElementById('scoreSection').style.display = 'none';
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('progressBar').style.width = '0%';
            
            document.querySelectorAll('.badge').forEach(badge => {
                badge.classList.remove('earned');
            });
            
            attempts = 0;
            chapterStartTime = Date.now();
            
            // Scroll para o topo
            scrollToTop();
        }
        
        function nextChapter() {
            if (currentChapter < 5) {
                switchToChapter(currentChapter + 1);
            } else {
                alert('üéâ Parab√©ns! Voc√™ terminou "The Perfect Neighbor"! üèÜüì∫\n\nVoltando ao A2 Low Level...');
                setTimeout(() => {
                    window.location.href = 'pure-reading-a2-low.html';
                }, 2000);
            }
        }
        
        // ===== INICIALIZA√á√ÉO =====
        document.addEventListener('DOMContentLoaded', function() {
            const studentName = getStudentName();
            document.getElementById('userName').textContent = studentName;
            
            console.log(`üì∫ The Perfect Neighbor REDESIGNED - usu√°rio: ${studentName}`);
            console.log('‚ú® Design completamente reformulado!');
            console.log('üì± Mobile-first e desktop perfeito');
            
            createChapterCards();
            loadChapter(currentChapter);
        });
    </script>
</body>
</html>
