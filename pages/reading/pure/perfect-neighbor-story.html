<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Perfect Neighbor - Teacher Alex English Academy</title>
    
    <!-- CSS Universal -->
    <link rel="stylesheet" href="../../../src/styles/base.css">
    <link rel="stylesheet" href="../../../src/styles/layout.css">
    <link rel="stylesheet" href="../../../src/styles/theme-patriot.css">
    
    <style>
        /* ===== PURE READING REVOLUTION ===== */
        
        /* Reading Container - Perfeito para Leitura Longa */
        .reading-container {
            max-width: 750px;
            margin: 0 auto;
            background: #fefefe;
            border-radius: var(--radius-large);
            box-shadow: 0 8px 32px rgba(0,0,0,0.12);
            border: 1px solid #e8eaed;
            overflow: hidden;
        }
        
        /* Story Header - Visual Hierarchy */
        .story-header-reading {
            background: linear-gradient(135deg, var(--blue-dark) 0%, var(--blue-medium) 100%);
            color: white;
            padding: 40px;
            text-align: center;
            border-bottom: 4px solid var(--blue-dark);
        }
        
        .story-title-reading {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 15px;
            text-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        
        .story-subtitle-reading {
            font-size: 1.2rem;
            opacity: 0.9;
            font-weight: 500;
            margin-bottom: 20px;
        }
        
        .chapter-indicator {
            background: rgba(255,255,255,0.2);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            display: inline-block;
        }
        
        /* Revolutionary Text Formatting */
        .story-content {
            padding: 50px;
            font-family: 'Georgia', 'Times New Roman', serif;
            font-size: 1.25rem;
            line-height: 1.8;
            color: #2c3e50;
            background: #fefefe;
        }
        
        .story-content p {
            margin-bottom: 2rem;
            text-align: justify;
            hyphens: auto;
            -webkit-hyphens: auto;
            -moz-hyphens: auto;
        }
        
        .story-content p:first-child {
            font-size: 1.35rem;
            font-weight: 500;
            color: var(--blue-dark);
            border-left: 4px solid var(--blue-medium);
            padding-left: 20px;
            margin-bottom: 2.5rem;
        }
        
        .story-content p:not(:first-child) {
            text-indent: 2rem;
        }
        
        /* Dialogue Formatting */
        .story-content p:has(") {
            font-style: italic;
            color: #34495e;
            margin-left: 1rem;
            border-left: 2px solid #ecf0f1;
            padding-left: 1rem;
        }
        
        /* Section Breaks */
        .section-break {
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 3rem 0;
        }
        
        .section-break::before {
            content: "‚ùñ ‚ùñ ‚ùñ";
            color: var(--blue-medium);
            font-size: 1.5rem;
            opacity: 0.6;
        }
        
        /* Mobile-First Revolution */
        @media (max-width: 768px) {
            .reading-container {
                margin: 0;
                border-radius: 0;
                border: none;
                box-shadow: none;
            }
            
            .story-header-reading {
                padding: 30px 25px;
            }
            
            .story-title-reading {
                font-size: 1.8rem;
                margin-bottom: 12px;
            }
            
            .story-subtitle-reading {
                font-size: 1rem;
                margin-bottom: 15px;
            }
            
            .story-content {
                padding: 30px 25px;
                font-size: 1.1rem;
                line-height: 1.7;
            }
            
            .story-content p {
                text-align: left;
                text-indent: 0;
                margin-bottom: 1.5rem;
            }
            
            .story-content p:first-child {
                font-size: 1.2rem;
                padding-left: 15px;
                margin-bottom: 2rem;
            }
            
            .story-content p:not(:first-child) {
                text-indent: 0;
            }
        }
        
        @media (max-width: 480px) {
            .story-content {
                padding: 25px 20px;
                font-size: 1.05rem;
                line-height: 1.65;
            }
            
            .story-content p {
                margin-bottom: 1.3rem;
            }
        }
        
        /* Reading Mode Toggle */
        .reading-controls {
            position: fixed;
            top: 120px;
            right: 20px;
            background: white;
            border-radius: var(--radius-large);
            padding: 15px;
            box-shadow: var(--shadow-medium);
            border: 1px solid var(--gray-200);
            z-index: 100;
        }
        
        .font-size-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .font-control {
            background: var(--blue-medium);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
        }
        
        .font-control:hover {
            background: var(--blue-dark);
        }
        
        .reading-mode-toggle {
            background: var(--dark);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 0.85rem;
            width: 100%;
            transition: var(--transition);
        }
        
        /* Dark Reading Mode */
        .dark-mode .story-content {
            background: #1a1a1a;
            color: #e8e8e8;
        }
        
        .dark-mode .reading-container {
            background: #1a1a1a;
            border-color: #333;
        }
        
        .dark-mode .story-content p:first-child {
            color: #64b5f6;
            border-left-color: #64b5f6;
        }
        
        /* Hide on mobile */
        @media (max-width: 768px) {
            .reading-controls {
                display: none;
            }
        }
        
        /* Chapter Navigation Improved */
        .chapter-navigation-reading {
            background: white;
            border-radius: var(--radius-large);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-light);
            border: 1px solid var(--gray-200);
        }
        
        .chapter-cards-reading {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .chapter-card-reading {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius);
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition-smooth);
            position: relative;
        }
        
        .chapter-card-reading:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-medium);
            border-color: var(--blue-medium);
        }
        
        .chapter-card-reading.active {
            background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%);
            border-color: var(--warning);
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.3);
        }
        
        .chapter-card-reading.completed {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-color: var(--success);
        }
        
        .chapter-icon-reading {
            font-size: 2rem;
            margin-bottom: 10px;
            display: block;
        }
        
        .chapter-number-reading {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--blue-dark);
            margin-bottom: 5px;
        }
        
        .chapter-title-reading {
            font-size: 1rem;
            font-weight: 700;
            color: var(--dark);
            line-height: 1.2;
        }
        
        /* Questions Section Improved */
        .questions-reading {
            background: white;
            border-radius: var(--radius-large);
            padding: 40px;
            margin-top: 40px;
            box-shadow: var(--shadow-light);
            border: 1px solid var(--gray-200);
        }
        
        .questions-title {
            font-size: 1.8rem;
            color: var(--blue-dark);
            margin-bottom: 30px;
            text-align: center;
            font-weight: 700;
        }
    </style>
</head>
<body>
    <!-- User Widget -->
    <div class="user-widget">
        <div class="user-avatar" id="userAvatar">A</div>
        <span class="user-name" id="userName">Aluno</span>
        <button class="logout-btn" onclick="logout()">Sair</button>
    </div>

    <!-- Reading Controls -->
    <div class="reading-controls">
        <div class="font-size-controls">
            <button class="font-control" onclick="changeFontSize(-1)">A-</button>
            <button class="font-control" onclick="changeFontSize(1)">A+</button>
        </div>
        <button class="reading-mode-toggle" onclick="toggleDarkMode()">üåô Modo Noturno</button>
    </div>

    <div class="container">
        <!-- Back Navigation -->
        <a href="a2-low.html" class="back-button">
            ‚Üê Voltar ao A2 Low Level
        </a>
        
        <!-- Header -->
        <header class="header">
            <h1 class="logo">Teacher Alex <span class="logo-highlight">English Academy</span></h1>
            <h2 class="hub-title">üìñ Pure Reading Hub</h2>
            <p class="hub-subtitle">Experi√™ncia de leitura otimizada para autonomia total</p>
        </header>

        <!-- Progress Section -->
        <section class="stats-section">
            <h2 class="stats-title">üìä Seu Progresso</h2>
            <div class="progress-section">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar"></div>
                </div>
                <div class="badges">
                    <div class="badge" id="badge1">üìö Primeira Leitura</div>
                    <div class="badge" id="badge2">üéØ Boa Pontua√ß√£o</div>
                    <div class="badge" id="badge3">‚≠ê Cap√≠tulo Perfeito</div>
                    <div class="badge" id="badge4">üß† Mestre da Gram√°tica</div>
                    <div class="badge" id="badge5">üîç Leitor Atento</div>
                </div>
            </div>
        </section>
        
        <!-- Chapter Navigation -->
        <section class="chapter-navigation-reading">
            <h2 class="stats-title">üìñ Escolha seu Cap√≠tulo</h2>
            <div class="chapter-cards-reading" id="chapterCards">
                <!-- Cards ser√£o gerados dinamicamente -->
            </div>
        </section>
        
        <!-- Reading Experience Revolution -->
        <main class="reading-container">
            <!-- Story Header -->
            <div class="story-header-reading">
                <h1 class="story-title-reading" id="chapterTitle">The New Neighbor</h1>
                <p class="story-subtitle-reading">Um thriller psicol√≥gico sobre obsess√£o e identidade</p>
                <div class="chapter-indicator" id="chapterIndicator">Cap√≠tulo 1 de 5</div>
            </div>
            
            <!-- Story Content -->
            <div class="story-content" id="storyContent">
                <!-- Texto ser√° inserido aqui -->
            </div>
        </main>
        
        <!-- Questions -->
        <div class="questions-reading" id="questionsContainer">
            <h3 class="questions-title">üìù Teste sua Compreens√£o</h3>
            <!-- Quest√µes ser√£o inseridas aqui -->
        </div>
        
        <!-- Controls -->
        <div class="controls">
            <button class="btn" onclick="checkAnswers()">‚úÖ Verificar Respostas</button>
            <button class="btn btn-secondary" onclick="resetQuiz()">üîÑ Reiniciar</button>
            <button class="btn" onclick="nextChapter()">‚û°Ô∏è Pr√≥ximo Cap√≠tulo</button>
        </div>
        
        <!-- Score -->
        <div id="scoreSection" class="score" style="display: none;">
            Sua Pontua√ß√£o: <span id="scoreValue">0</span>/5 üìö
        </div>
        
        <!-- Feedback -->
        <div id="feedback" class="feedback" style="display: none;"></div>
        
        <!-- Footer -->
        <footer class="footer">
            <h3>üì∫ The Perfect Neighbor</h3>
            <p>Experi√™ncia de leitura profissional para desenvolvimento aut√¥nomo</p>
        </footer>
    </div>

    <script>
        // ===== AUTH CHECK =====
        if (sessionStorage.getItem('studentLoggedIn') !== 'true') {
            window.location.href = '../../auth/login.html';
        }

        // ===== INITIALIZATION =====
        const studentName = sessionStorage.getItem('studentUsername') || 'Student';
        document.getElementById('userName').textContent = studentName;
        document.getElementById('userAvatar').textContent = studentName.charAt(0).toUpperCase();

        // ===== STORY DATA =====
        const chapters = {
            1: { 
                title: "The New Neighbor", 
                icon: "üëã", 
                story: `Paula lives in a quiet street with her husband Carlos. They are happy together for five years. Carlos works at a bank. Paula is a teacher.

One morning, Paula sees a moving truck. Someone new is moving to the house next door.

"Carlos, we have a new neighbor!" Paula says.

"That's nice," Carlos says, drinking his coffee.

A beautiful woman comes out of the house. She has long blonde hair and expensive clothes. She sees Paula and smiles.

"Hello!" the woman calls. "I'm Helena. I'm your new neighbor!"

Paula walks over. "Hi! I'm Paula. Welcome to the neighborhood!"

Helena looks at Paula very carefully. Her eyes study Paula's hair, her dress, her shoes.

"You have beautiful hair," Helena says. "What salon do you go to?"

"Oh, just Salon Maria on Main Street," Paula answers.

"And your dress! So pretty! Where did you buy it?"

"The mall. Nothing special," Paula laughs.

Helena keeps asking questions. About Paula's job, her schedule, her favorite places. Paula thinks Helena is just being friendly.

"Would you like coffee tomorrow morning?" Helena asks.

"Sure! I'd love that," Paula says.

That night, Paula tells Carlos about Helena.

"She seems very nice," Paula says. "But she asked so many questions!"

"New neighbors always do that," Carlos says. "They want to know about the area."

Paula nods. But something feels strange. Helena's questions were not about the neighborhood. They were all about Paula.

The next morning, Paula looks out her window. Helena is in her garden, but she's not gardening. She's watching Paula's house.

When Helena sees Paula, she waves and smiles. "Ready for coffee?"

Paula feels uncomfortable, but she goes anyway. Helena's house is beautiful inside. Very expensive furniture. Very clean.

"You have a lovely home," Paula says.

"Thank you. I want everything to be perfect," Helena says. Her eyes are very bright. Too bright.

They drink coffee and talk. But Helena keeps staring at Paula. Studying her.

"I hope we can be best friends," Helena says suddenly.

Paula smiles politely. But inside, she feels worried. There's something wrong with her perfect neighbor.`, 
                questions: { 
                    q1: { type: "comprehension", text: "How long have Paula and Carlos been together?", options: ["Three years", "Five years", "Ten years", "Two years"], correct: "b" }, 
                    q2: { type: "comprehension", text: "What does Helena look like?", options: ["Short dark hair", "Long blonde hair", "Red hair", "Curly brown hair"], correct: "b" }, 
                    q3: { type: "comprehension", text: "What makes Paula feel uncomfortable?", options: ["Helena's expensive clothes", "Helena asking too many questions", "Helena's beautiful house", "Helena's garden"], correct: "b" }, 
                    q4: { type: "grammar", text: 'Complete: "Paula _____ in a quiet street."', options: ["live", "lives", "living", "lived"], correct: "b" }, 
                    q5: { type: "grammar", text: "Which sentence is correct?", options: ["They are happy together for five years.", "They is happy together for five years.", "They am happy together for five years.", "They was happy together for five years."], correct: "a" } 
                } 
            },
            2: { 
                title: "Strange Things", 
                icon: "üëÅÔ∏è", 
                story: `Three weeks pass. Helena visits Paula every day. She always wants to know Paula's plans.

"What are you doing today?" Helena asks every morning.

"Going to the market," Paula says.

Two hours later, Paula sees Helena at the same market. This happens many times.

Paula goes to the pharmacy. Helena is there.

Paula goes to the coffee shop. Helena appears.

Paula visits her mother. Helena is on the same street.

"This is very strange," Paula tells her friend Lisa. "My neighbor is always in the same places as me."

"Maybe it's just coincidence," Lisa says.

But Paula doesn't think so. Something else is bothering her. Helena is changing.

When they first met, Helena wore expensive designer clothes. Now she wears simple dresses. Like Paula's dresses.

Helena had long blonde hair. Last week, she cut it short and dyed it brown. Like Paula's hair.

Helena bought the same car as Paula. The same color.

"Carlos, don't you think this is weird?" Paula asks her husband.

"What's weird?" Carlos is watching TV.

"Helena! She's copying everything I do!"

Carlos laughs. "Paula, you're being paranoid. She just has similar taste."

But Paula knows it's more than that. Yesterday, she saw Helena talking to Carlos when he came home from work.

"What did Helena want?" Paula asked.

"She was just being friendly. She asked about my job, my schedule. Nice woman," Carlos said.

Paula felt angry. Why was Helena asking about Carlos's schedule?

That evening, Paula decides to test something. She tells Helena a lie.

"I'm going to change my hair color," Paula says. "I want to try blonde."

Helena's eyes get very bright. "Blonde? Really? When?"

"Next week," Paula lies.

Three days later, Paula sees Helena coming out of Salon Maria. Her hair is now blonde. Exactly like Paula described.

Paula feels scared now. This is not normal. Helena is not just copying her style. Helena wants to BE her.

Paula calls Lisa. "Something is very wrong with my neighbor."

"What do you mean?" Lisa asks.

"She's trying to become me! Same hair, same clothes, same places. Lisa, I think she wants my life!"

"That's crazy, Paula."

"Is it? What if she wants my husband too?"

Lisa is quiet. Then she says, "Paula, you need to be careful."

That night, Paula locks all her doors. She closes all her curtains. But she can feel Helena watching her house.

In her perfect neighbor's perfect window.`, 
                questions: { 
                    q1: { type: "comprehension", text: "How often does Helena visit Paula?", options: ["Once a week", "Every day", "Never", "Twice a week"], correct: "b" }, 
                    q2: { type: "comprehension", text: "What does Helena change about herself?", options: ["Her clothes and hair", "Her house", "Her car only", "Her job"], correct: "a" }, 
                    q3: { type: "comprehension", text: "How does Paula test Helena?", options: ["She tells her a lie about changing her hair", "She follows her", "She asks Carlos to help", "She calls the police"], correct: "a" }, 
                    q4: { type: "grammar", text: 'Complete: "Helena _____ visits Paula every day."', options: ["always", "never", "sometimes", "rarely"], correct: "a" }, 
                    q5: { type: "grammar", text: "Which sentence uses past tense correctly?", options: ["She cut it short and dyed it brown.", "She cuts it short and dies it brown.", "She cutting it short and dying it brown.", "She cuts it short and dyed it brown."], correct: "a" } 
                } 
            },
            3: { 
                title: "The Obsession", 
                icon: "üí≠", 
                story: `Paula's worst fears come true. Helena is now identical to her. Same hair, same makeup, same clothes. When they walk down the street together, people think they are sisters.

But Helena wants more.

Paula finds Helena in her garden, talking to Carlos again.

"Helena was just asking about our anniversary," Carlos explains. "She wants to know how we met."

"Why does she want to know that?" Paula asks.

"She's interested in love stories," Carlos says. "She's very romantic."

Paula feels sick. Helena is studying her marriage now.

The next week, Paula sees Helena at the flower shop. She's buying the same flowers that Carlos buys for Paula every Friday.

Paula follows Helena to a restaurant. Helena is there alone, but she orders Paula's favorite meal. She practices eating like Paula eats.

"This woman is completely insane!" Paula tells Lisa.

"Have you talked to Carlos about this?"

"He thinks I'm being dramatic. He says Helena is just lonely and wants friends."

But Paula knows the truth. Helena doesn't want to be Paula's friend. Helena wants to BE Paula.

Paula decides to search for information about Helena. She goes to the post office.

"Excuse me," Paula asks the worker. "My neighbor Helena Santos... has she lived here long?"

The worker checks the computer. "Helena Santos? No one with that name receives mail here."

"But she lives next door to me!"

"The house next door? That's registered to someone else. A man named Roberto Silva."

Paula feels confused. "But Helena said she bought the house..."

"Roberto Silva bought it six months ago. He doesn't live there. He rents it to someone, but not Helena Santos."

Paula's hands start shaking. Helena lied about her name. She lied about everything.

Paula goes home and calls the rental agency.

"I'd like information about the renter at 245 Rose Street," Paula says.

"I can't give personal information," the woman says.

"Please! She's my neighbor. I think she's dangerous!"

The woman is quiet. Then she whispers, "Have you had problems with her?"

"Yes! Why?"

"We've had three complaints about that tenant. She... she copies other tenants. Follows them. The last tenant moved away because of her."

Paula drops the phone. Helena has done this before. To other women. Other lives.

And now Helena wants Paula's life. Paula's husband. Paula's everything.

That evening, Paula watches from her window. Helena is in her garden, but she's not alone. Carlos is there. They're talking very close together. Too close.

Helena touches Carlos's arm. She laughs at something he says. She looks at him the way Paula looks at him.

"No," Paula whispers. "You will not take my husband. You will not take my life!"

But how can she stop someone who is becoming her exact copy?`, 
                questions: { 
                    q1: { type: "comprehension", text: "What does Helena ask Carlos about?", options: ["His job", "His anniversary and love story", "His family", "His hobbies"], correct: "b" }, 
                    q2: { type: "comprehension", text: "What does Paula discover at the post office?", options: ["Helena uses a fake name", "Helena is married", "Helena has money problems", "Helena is rich"], correct: "a" }, 
                    q3: { type: "comprehension", text: "How many complaints has the rental agency received about Helena?", options: ["One", "Two", "Three", "Four"], correct: "c" }, 
                    q4: { type: "grammar", text: 'Complete: "Helena _____ more."', options: ["want", "wants", "wanting", "wanted"], correct: "b" }, 
                    q5: { type: "grammar", text: "Which sentence is in present perfect?", options: ["We had three complaints.", "We have had three complaints.", "We are having three complaints.", "We will have three complaints."], correct: "b" } 
                } 
            },
            4: { 
                title: "The Confrontation", 
                icon: "‚ö°", 
                story: `Paula cannot sleep. She watches Helena's house all night. In the morning, she sees something that makes her blood freeze.

Helena comes out of her house wearing Paula's exact outfit. The dress Paula planned to wear today. But Paula never told Helena about this dress.

Helena has been in Paula's house. In Paula's closet.

Paula runs to check her spare key. It's gone.

"That's it!" Paula screams. "This ends today!"

Paula marches to Helena's house and pounds on the door.

"Helena! Open this door now!"

Helena opens the door, smiling sweetly. "Good morning, Paula! Don't you love this dress? We have such similar taste!"

"You stole my key! You were in my house!" Paula shouts.

"What are you talking about?" Helena asks innocently.

"Stop pretending! I know what you're doing! You're copying my life! You want to steal my husband!"

Helena's sweet smile disappears. Her eyes become cold and dangerous.

"Steal?" Helena laughs. "I don't need to steal anything. Carlos is already falling in love with me."

Paula feels like someone hit her. "What?"

"Men are so simple," Helena says. "I look like you, but I'm more interesting. More mysterious. Carlos tells me things he doesn't tell you."

"You're lying!"

"Am I? He told me your marriage is boring. He said you never surprise him anymore. But I... I surprise him every day."

Paula wants to hit Helena, but she controls herself. "Carlos loves me!"

"Does he? When was the last time he brought you flowers without you asking? When was the last time he looked at you the way he looks at me?"

Paula's heart breaks because Helena is right. Carlos has been distant lately.

"You manipulated him!" Paula cries.

"I gave him what you stopped giving him. Attention. Excitement. A woman who listens."

"I listen to him!"

"No, you complain. About work, about money, about everything. I never complain. I'm perfect."

Helena steps closer. "Face the truth, Paula. I'm a better version of you. Younger, prettier, more interesting. Carlos deserves better than a boring wife."

"He's MY husband!"

"Not for long," Helena says. "Tonight, Carlos is taking me to dinner. He's going to tell you about us. He's going to ask for a divorce."

Paula feels the world spinning. "No... no, he wouldn't..."

"Check his phone," Helena suggests. "Read our messages. See how happy I make him."

Paula runs home. With shaking hands, she picks up Carlos's phone. It's unlocked.

Messages between Carlos and Helena:
"Thank you for listening to me."
"You understand me like Paula never did."
"I've never felt this way before."
"Tonight we need to talk about our future."

Paula drops the phone and starts crying. Her perfect marriage is destroyed. Her perfect neighbor has won.

But then Paula gets angry. Very angry.

"No," she says through her tears. "I will not let this woman destroy my life. I will fight!"`, 
                questions: { 
                    q1: { type: "comprehension", text: "How does Paula know Helena was in her house?", options: ["Helena is wearing Paula's exact outfit", "Things are missing", "A neighbor saw her", "Carlos told her"], correct: "a" }, 
                    q2: { type: "comprehension", text: "What does Helena say about Carlos?", options: ["He's not interested in her", "He's falling in love with her", "He wants to move away", "He's afraid of her"], correct: "b" }, 
                    q3: { type: "comprehension", text: "What does Paula find on Carlos's phone?", options: ["Photos", "Messages between Carlos and Helena", "Nothing suspicious", "Games"], correct: "b" }, 
                    q4: { type: "grammar", text: 'Complete: "Helena _____ been in Paula\'s house."', options: ["has", "have", "had", "having"], correct: "a" }, 
                    q5: { type: "grammar", text: "Which sentence uses the correct comparative?", options: ["I'm more interesting.", "I'm most interesting.", "I'm interestinger.", "I'm very interesting."], correct: "a" } 
                } 
            },
            5: { 
                title: "The Truth Revealed", 
                icon: "üö®", 
                story: `Paula calls her friend Lisa. "I need your help. Tonight, Carlos is meeting Helena. I need to prove she's dangerous."

"What's your plan?"

"I'm going to follow them. And I need you to call the police if something happens."

That evening, Carlos gets dressed nicely. "I'm going out with some friends," he lies.

"Have fun," Paula says, pretending she doesn't know.

Paula follows Carlos to the restaurant. She sits where she can see their table. Carlos looks nervous. Helena looks beautiful and confident.

Paula can't hear their conversation, but she can see Helena touching Carlos's hand. Carlos looks confused and sad.

Then Paula remembers something. The rental agency said they had Helena's phone number. Paula calls them.

"This is an emergency," Paula says. "I need that woman's real information. She's dangerous!"

"Her real name is Elena Rojas," the woman whispers. "She has a criminal record. Stalking. Identity theft. She does this to married couples."

Paula's blood freezes. "Married couples?"

"She destroys marriages, steals the husband, then disappears with their money. She's done it five times."

Paula hangs up and calls the police immediately.

"My neighbor is a criminal! She's with my husband right now!"

While Paula waits for the police, she sees Helena and Carlos leaving the restaurant. Helena is pulling Carlos toward her car.

Paula follows them to Helena's house. Through the window, she can see Helena giving Carlos wine. Too much wine. Carlos looks dizzy.

"She's drugging him!" Paula realizes.

Paula calls the police again. "Hurry! She's drugging my husband!"

Paula can't wait. She breaks Helena's back door and runs inside.

"Get away from my husband!" Paula screams.

Helena spins around. Her sweet mask is gone. She looks crazy now.

"You ruined everything!" Helena shouts. "He was ready to leave you!"

"Carlos!" Paula shakes her husband. "Carlos, wake up!"

Carlos opens his eyes slowly. "Paula? What... where am I?"

"Elena drugged you!" Paula says.

"Elena? Who's Elena?" Carlos looks confused.

"Your perfect neighbor! Her real name is Elena Rojas! She's a criminal!"

The police arrive. They arrest Helena/Elena. In her house, they find photos of Paula, copies of Paula's documents, and drugs.

"She was planning to steal your identity," the detective explains. "And probably your husband's money too."

Carlos holds Paula tightly. "I'm so sorry. She made me feel... I don't know how to explain it."

"She manipulated you," Paula says. "She's an expert."

The detective continues, "Elena drugs men to make them confused and emotional. Then she convinces them to leave their wives and give her access to their bank accounts."

"But I never gave her money," Carlos says.

"Not yet. But she was working on it. We found papers. She was planning to convince you to invest in a fake business with her."

Carlos looks sick. "Paula, I almost destroyed our marriage for a criminal."

"She's very good at what she does," the detective says. "You're lucky your wife discovered the truth."

Elena is taken away in handcuffs. As she passes Paula, she hisses, "This isn't over."

"Yes, it is," Paula says firmly.

One month later, Paula and Carlos are in therapy, working on their marriage. They're stronger now.

"I learned something," Carlos says. "I was taking you for granted. I forgot how special you are."

"And I learned to trust my instincts," Paula says. "When something feels wrong, it probably is."

They look at Helena's old house. A new family is moving in. A normal family.

"No more perfect neighbors," Carlos jokes.

"No," Paula agrees. "Perfect is always suspicious."

They laugh and go inside their house. Their real, imperfect, honest house.

Because sometimes, the perfect neighbor is perfectly dangerous.`, 
                questions: { 
                    q1: { type: "comprehension", text: "What is Helena's real name?", options: ["Elena Santos", "Elena Rojas", "Elena Silva", "Elena Martinez"], correct: "b" }, 
                    q2: { type: "comprehension", text: "How many times has Elena done this before?", options: ["Three times", "Five times", "Seven times", "Two times"], correct: "b" }, 
                    q3: { type: "comprehension", text: "What was Elena's final plan?", options: ["To steal Paula's identity and Carlos's money", "To move away", "To become Paula's best friend", "To buy a new house"], correct: "a" }, 
                    q4: { type: "grammar", text: 'Complete: "Elena _____ men to make them confused."', options: ["drug", "drugs", "drugging", "drugged"], correct: "b" }, 
                    q5: { type: "grammar", text: "Which sentence is in past continuous?", options: ["She planned to steal your identity.", "She was planning to steal your identity.", "She plans to steal your identity.", "She will plan to steal your identity."], correct: "b" } 
                } 
            }
        };

        // ===== READING EXPERIENCE FEATURES =====
        let currentFontSize = 1.25;
        let isDarkMode = false;
        let currentChapter = 1;
        let studentProgress = {
            data: { neighbor: { chaptersCompleted: [], bestScores: {}, badges: [] } }
        };

        function changeFontSize(delta) {
            currentFontSize += delta * 0.1;
            currentFontSize = Math.max(1.0, Math.min(1.8, currentFontSize));
            
            const storyContent = document.getElementById('storyContent');
            storyContent.style.fontSize = currentFontSize + 'rem';
            
            localStorage.setItem('reading_font_size', currentFontSize);
        }

        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);
            
            const toggleBtn = document.querySelector('.reading-mode-toggle');
            toggleBtn.textContent = isDarkMode ? '‚òÄÔ∏è Modo Claro' : 'üåô Modo Noturno';
            
            localStorage.setItem('reading_dark_mode', isDarkMode);
        }

        function loadProgress() {
            const progressKey = `progress_${studentName}`;
            const saved = localStorage.getItem(progressKey);
            
            if (saved) {
                try {
                    studentProgress.data = JSON.parse(saved);
                    if (!studentProgress.data.neighbor) {
                        studentProgress.data.neighbor = { chaptersCompleted: [], bestScores: {}, badges: [] };
                    }
                } catch (e) {
                    console.error('Erro ao carregar progresso:', e);
                }
            }
        }

        function saveProgress(chapterNumber, score) {
            const chapter = `chapter_${chapterNumber}`;
            
            if (!studentProgress.data.neighbor.chaptersCompleted.includes(chapter)) {
                studentProgress.data.neighbor.chaptersCompleted.push(chapter);
            }
            
            if (!studentProgress.data.neighbor.bestScores[chapter] || score > studentProgress.data.neighbor.bestScores[chapter]) {
                studentProgress.data.neighbor.bestScores[chapter] = score;
            }
            
            const progressKey = `progress_${studentName}`;
            localStorage.setItem(progressKey, JSON.stringify(studentProgress.data));
            
            createChapterCards();
        }

        // ===== CHAPTER NAVIGATION =====
        function createChapterCards() {
            const container = document.getElementById('chapterCards');
            container.innerHTML = '';
            
            for (let i = 1; i <= 5; i++) {
                const chapter = chapters[i];
                const isCompleted = studentProgress.data.neighbor.chaptersCompleted.includes(`chapter_${i}`);
                const bestScore = studentProgress.data.neighbor.bestScores[`chapter_${i}`] || 0;
                const isActive = i === currentChapter;
                
                const card = document.createElement('div');
                card.className = `chapter-card-reading ${isActive ? 'active' : ''} ${isCompleted ? 'completed' : ''}`;
                card.onclick = () => switchToChapter(i);
                
                card.innerHTML = `
                    <div class="chapter-icon-reading">${chapter.icon}</div>
                    <div class="chapter-number-reading">Cap. ${i}</div>
                    <div class="chapter-title-reading">${chapter.title}</div>
                    ${isCompleted ? `<div style="position: absolute; top: 5px; right: 5px; background: var(--success); color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold;">${bestScore}</div>` : ''}
                `;
                
                container.appendChild(card);
            }
        }

        function switchToChapter(chapterNumber) {
            currentChapter = chapterNumber;
            loadChapter(currentChapter);
            createChapterCards();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function loadChapter(chapterNumber) {
            const chapter = chapters[chapterNumber];
            
            document.getElementById('chapterTitle').textContent = chapter.title;
            document.getElementById('chapterIndicator').textContent = `Cap√≠tulo ${chapterNumber} de 5`;
            
            // Revolutionary Text Formatting with proper paragraph breaks
            const formattedStory = chapter.story
                .split('\n\n')
                .map(paragraph => paragraph.trim())
                .filter(paragraph => paragraph.length > 0)
                .map(paragraph => `<p>${paragraph}</p>`)
                .join('');
            
            // Add section breaks every 4 paragraphs for better reading rhythm
            const paragraphs = formattedStory.split('</p>');
            let finalStory = '';
            
            paragraphs.forEach((p, index) => {
                if (p.trim()) {
                    finalStory += p + '</p>';
                    // Add section break every 4 paragraphs (except last)
                    if ((index + 1) % 4 === 0 && index < paragraphs.length - 2) {
                        finalStory += '<div class="section-break"></div>';
                    }
                }
            });
            
            document.getElementById('storyContent').innerHTML = finalStory;
            
            loadQuestions(chapter.questions);
            resetQuiz();
        }

        function loadQuestions(questions) {
            const container = document.getElementById('questionsContainer');
            let questionsHTML = '<h3 class="questions-title">üìù Teste sua Compreens√£o</h3>';
            
            Object.keys(questions).forEach((key, index) => {
                const q = questions[key];
                questionsHTML += `
                    <div class="question">
                        <div class="question-type ${q.type}">${q.type === 'grammar' ? 'GRAM√ÅTICA' : 'INTERPRETA√á√ÉO'}</div>
                        <div class="question-text">${index + 1}. ${q.text}</div>
                        <div class="options">
                            ${q.options.map((opt, i) => `
                                <div class="option" onclick="selectOption('${key}', '${String.fromCharCode(97 + i)}')">
                                    <input type="radio" name="${key}" value="${String.fromCharCode(97 + i)}" id="${key}_${i}">
                                    <label for="${key}_${i}">${String.fromCharCode(97 + i).toUpperCase()}) ${opt}</label>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = questionsHTML;
        }

        function selectOption(questionName, value) {
            // Reset all options for this question
            document.querySelectorAll(`input[name="${questionName}"]`).forEach(opt => {
                opt.closest('.option').classList.remove('selected');
            });
            
            // Select clicked option
            const selectedRadio = document.querySelector(`input[name="${questionName}"][value="${value}"]`);
            selectedRadio.checked = true;
            selectedRadio.closest('.option').classList.add('selected');
        }

        // ===== QUIZ FUNCTIONS =====
        function checkAnswers() {
            const chapter = chapters[currentChapter];
            const questions = Object.keys(chapter.questions);
            let score = 0;
            let feedback = [];
            
            questions.forEach((key, index) => {
                const selected = document.querySelector(`input[name="${key}"]:checked`);
                const correct = chapter.questions[key].correct;
                const q = chapter.questions[key];
                
                // Reset styles
                document.querySelectorAll(`input[name="${key}"]`).forEach(opt => {
                    opt.closest('.option').classList.remove('correct-answer', 'wrong-answer');
                });
                
                // Mark correct answer
                const correctOption = document.querySelector(`input[name="${key}"][value="${correct}"]`);
                correctOption.closest('.option').classList.add('correct-answer');
                
                if (selected) {
                    if (selected.value === correct) {
                        score++;
                        feedback.push(`<p><strong>Quest√£o ${index + 1}:</strong> ‚úÖ Correto!</p>`);
                    } else {
                        selected.closest('.option').classList.add('wrong-answer');
                        const correctText = q.options[correct.charCodeAt(0) - 97];
                        feedback.push(`<p><strong>Quest√£o ${index + 1}:</strong> ‚ùå Incorreto. Resposta correta: ${correctText}</p>`);
                    }
                } else {
                    feedback.push(`<p><strong>Quest√£o ${index + 1}:</strong> ‚ö™ N√£o respondida</p>`);
                }
            });
            
            // Save progress
            saveProgress(currentChapter, score);
            
            // Update badges
            updateBadges(score);
            
            // Show results
            document.getElementById('progressBar').style.width = (score / 5) * 100 + '%';
            document.getElementById('scoreValue').textContent = score;
            document.getElementById('scoreSection').style.display = 'block';
            
            const feedbackEl = document.getElementById('feedback');
            feedbackEl.innerHTML = `
                <h3>üìä Resultado: ${score}/5 pontos</h3>
                ${feedback.join('')}
            `;
            feedbackEl.style.display = 'block';
            
            // Scroll to results
            document.getElementById('scoreSection').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'center' 
            });
        }

        function updateBadges(score) {
            if (studentProgress.data.neighbor.chaptersCompleted.length >= 1) {
                document.getElementById('badge1').classList.add('earned');
            }
            if (score >= 4) {
                document.getElementById('badge2').classList.add('earned');
            }
            if (score === 5) {
                document.getElementById('badge3').classList.add('earned');
            }
            if (score >= 4) {
                document.getElementById('badge4').classList.add('earned');
            }
            if (score >= 3) {
                document.getElementById('badge5').classList.add('earned');
            }
        }

        function resetQuiz() {
            document.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.checked = false;
                radio.closest('.option').classList.remove('selected', 'correct-answer', 'wrong-answer');
            });
            
            document.getElementById('scoreSection').style.display = 'none';
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('progressBar').style.width = '0%';
            
            document.querySelectorAll('.badge').forEach(badge => {
                badge.classList.remove('earned');
            });
        }

        function nextChapter() {
            if (currentChapter < 5) {
                switchToChapter(currentChapter + 1);
            } else {
                alert('üéâ Parab√©ns! Voc√™ terminou "The Perfect Neighbor"!\n\nVoltando ao A2 Low Level...');
                setTimeout(() => {
                    window.location.href = 'a2-low.html';
                }, 1500);
            }
        }

        // ===== LOGOUT =====
        function logout() {
            sessionStorage.clear();
            window.location.href = '../../auth/login.html';
        }

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved preferences
            const savedFontSize = localStorage.getItem('reading_font_size');
            if (savedFontSize) {
                currentFontSize = parseFloat(savedFontSize);
                document.getElementById('storyContent').style.fontSize = currentFontSize + 'rem';
            }
            
            const savedDarkMode = localStorage.getItem('reading_dark_mode');
            if (savedDarkMode === 'true') {
                toggleDarkMode();
            }
            
            loadProgress();
            createChapterCards();
            loadChapter(currentChapter);
            
            console.log('üìñ PERFECT NEIGHBOR - READING REVOLUTION v4.0!');
            console.log('üë§ Usu√°rio:', studentName);
            console.log('üé® EXPERI√äNCIA DE LEITURA PREMIUM aplicada!');
            console.log('üì± Mobile-first typography otimizada!');
            console.log('üåô Modo noturno dispon√≠vel!');
            console.log('üî§ Controles de fonte funcionando!');
        });
    </script>
</body>
</html>
